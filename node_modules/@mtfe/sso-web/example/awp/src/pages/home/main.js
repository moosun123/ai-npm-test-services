// The Vue build version to load with the `import` command
// (runtime-only or standalone) has been set in webpack.base.conf with an alias.
import Vue from 'vue'
import App from './App'
import SSOWeb from '@mtfe/sso-web'
import router from './router/index'

Vue.config.productionTip = false
const rewriteLocation = {
  production: '/it/fe-sso-sdk-demo/home/index.html#', // 请注意index.html后面的# 一定要有
  development: '/pages/home/index.html#'
  // 其他环境....
}[process.env.NODE_ENV]

const ssoWeb = SSOWeb({
  clientId: 'test1',
  accessEnv: 'ppe', // ppe or product
  rewriteLocation
})

ssoWeb.login().then(ssoid => {
  if (typeof ssoid === 'string') {
    /* eslint-disable no-new */
    new Vue({
      el: '#app',
      router,
      render: h => {
        return h(App, {
          props: {
            client: ssoWeb,
            ssoid
          }
        })
      }
    })

    // 当前后端(Java后端)不是使用同一个clientId时，前端应把自己使用的clientId放到请求头部
    // axios.defaults.headers.common['client-id'] = "test1";

    // web sdk内部会把ssoid种到cookie，业务后端会读取cookie中的ssoid
    // 但跨域请求推荐将ssoid放到access-token, 后端SDK优先读取它
    // axios.defaults.headers.common['access-token'] = ssoid;
  }
})
