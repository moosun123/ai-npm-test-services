'use strict';

let assert = require('assert');
const path = require('path');
const { execSync } = require('child_process');
let Client = require('..');
const fileCreate = require('./filecreate');

var { accessKeyId, accessKeySecret, endpoint } = require('../sample/config/server.js');
const { privateCloud } = require('../sample/mss.config.js');
let equal = assert.equal;
const env = process.env;
describe('test keyMap', function() {
    before(function () {
        this.distPath = path.join(__dirname, '../sample/dist');
    });
    it('keyMap is undefined', async function () {
        const cdn = new Client({
            accessKeyId,
            accessKeySecret,
            endpoint,
            bucket: 'testccc',
            deployCatalog: this.distPath,
            keyMap: [
                {
                    keyRegExp: /\.html$/,
                    options: {
                        headers: {
                            'Cache-Control': 'no-cache'
                        }
                    }
                },
                {
                    keyRegExp: /test0\.js$/,
                    options: {
                        headers: {
                            'Cache-Control': 'max-age=60'
                        }
                    }
                }
            ]
        });
        const file = await cdn.deploy();
        const data = await cdn.listObject();
        await cdn.deleteObject(data);
    });

});