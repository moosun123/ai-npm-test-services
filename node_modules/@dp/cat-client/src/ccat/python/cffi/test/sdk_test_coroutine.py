#!/usr/bin/env python
# encoding: utf-8

import gevent
import time

from cat.cat import (
    catSdk,
    CAT_SUCCESS
)

cat = catSdk("test_corouting")


def do():
    print "excute do"
    name = "test_{0}".format(1)
    t = cat.new_transaction(name, name)
    time.sleep(0.5)
    cat.set_transaction_status(t, CAT_SUCCESS)
    cat.complete_transaction(t)
    print "exit do"


def do2():
    print "excute do2"
    name = "test_{0}".format(2)
    t = cat.new_transaction(name, name)
    time.sleep(0.4)
    cat.set_transaction_status(t, CAT_SUCCESS)
    cat.complete_transaction(t)
    print "exit do2"


def do3():
    print "excute do3"
    name = "test_{0}".format(3)
    t = cat.new_transaction(name, name)
    time.sleep(0.3)
    cat.set_transaction_status(t, CAT_SUCCESS)
    cat.complete_transaction(t)
    print "exit do3"


def do4():
    print "excute do4"
    name = "test_{0}".format(4)
    t = cat.new_transaction(name, name)
    time.sleep(0.2)
    cat.set_transaction_status(t, CAT_SUCCESS)
    cat.complete_transaction(t)
    print "exit do4"


if __name__ == "__main__":
    t = cat.new_transaction("test", "test")

    gevent.joinall([
        gevent.spawn(do),
        gevent.spawn(do2),
        gevent.spawn(do3),
        gevent.spawn(do4),
    ])

    cat.set_transaction_status(t, CAT_SUCCESS)
    cat.complete_transaction(t)

    while True:
        pass
