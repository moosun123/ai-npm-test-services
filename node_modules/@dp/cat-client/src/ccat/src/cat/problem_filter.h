//
// Created by Terence Fan on 3/6/19.
//

#ifndef CCAT_DP_PROBLEM_FILTER_H
#define CCAT_DP_PROBLEM_FILTER_H

#include <cat/transaction.h>
#include "message/message_imp.h"

#include <lib/cat_ccmap.h>

typedef struct _ProblemInterceptor {
    int capacity;
    CatCCHashMap *map;
} ProblemInterceptor;

typedef struct _ProblemFilter {
    ProblemInterceptor** interceptors;

    int (*isProblem)(CatTransaction* trans);

    int (*hit)(const char*);
    int (*hitTrans)(CatTransaction*);

    int (*clearCache)();
} CatProblemFilter;

int initProblemFilter();

void resetFailLogLimit(int newLimit);

int deleteProblemFilter();

int isErrorMessage(CatMessageInner* message);

int isProblem(CatTransaction* trans);

#endif //CCAT_DP_PROBLEM_FILTER_H
