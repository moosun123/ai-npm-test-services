//
// Created by Terence on 2018/8/1.
//

#include <gtest/gtest.h>

#include "lib/cat_semaphore.h"

TEST(Semaphore, test) {
    SEMA s;
    SEMA_INIT(s, 1, 3);
    SEMA_WAIT(s);
    SEMA_POST(s);
    SEMA_WAIT(s);
    SEMA_DESTROY(s);
}

TEST(Semaphore, testWaitTime) {
    SEMA s;
    SEMA_INIT(s, 1, 3);
    long r;
    r = SEMA_WAIT_TIME(s, 100);
    ASSERT_EQ(r, SEMA_WAIT_OK);
    r = SEMA_WAIT_TIME(s, 100);
    ASSERT_NE(r, SEMA_WAIT_OK);
    SEMA_DESTROY(s);
}

TEST(Semaphore, testTryWait) {
    SEMA s;
    SEMA_INIT(s, 1, 3);
    long r;
    r = SEMA_TRYWAIT(s);
    ASSERT_EQ(r, SEMA_WAIT_OK);
    r = SEMA_TRYWAIT(s);
    ASSERT_NE(r, SEMA_WAIT_OK);
    SEMA_DESTROY(s);
}
