//
// Created by Terence on 2018/9/14.
//

#include <gtest/gtest.h>

#include <cat/client.h>
#include <lib/cat_time_util.h>

#define TEST_EVENT "test-event"
#define TEST_ERROR "test-error"

TEST(Event, single) {
    CatEvent* e;
    e = newEvent(TEST_EVENT, "single");
    e->setComplete(e);

    e = newEvent(TEST_EVENT, "single");
    e->setStatus(e, CAT_FAIL);
    e->setComplete(e);

    logEvent(TEST_EVENT, "single-log-success", CAT_SUCCESS, "success");
    logEventWithTime(TEST_EVENT, "single-log-fail", CAT_FAIL, "fail", GetTime64() - 30 * 1000);
    logTrace(TEST_EVENT, "single-trace", CAT_SUCCESS, "trace");
}

TEST(Event, nested) {
    CatTransaction *t;
    t = newTransaction(TEST_EVENT, "nested-1");
    logEvent(TEST_EVENT, "nested-2", CAT_SUCCESS, "success");
    t->setComplete((CatMessage*) t);
}

TEST(Event, batch) {
    logBatchEvent(TEST_EVENT, "batch", 25, 10);
}

TEST(Event, error) {
    logError(TEST_ERROR, "error-1");
    logErrorTrace(TEST_ERROR, "error-2", "error message");
}
