include(DownloadProject.cmake)

message("download begin")
download_project(
    PROJ googletest
    GIT_REPOSITORY https://github.com/google/googletest.git
    GIT_TAG master
    UPDATE_DISCONNECTED 0
)
message("download success")

set(GTEST_DIR ${CMAKE_BINARY_DIR}/googletest-src/googletest)
message(STATUS "GTEST_DIR: ${GTEST_DIR}")
message(STATUS "WORK_DIR: ${CMAKE_CURRENT_BINARY_DIR}")

execute_process(COMMAND g++ -std=c++11 -I${GTEST_DIR}/include -I${GTEST_DIR} -c ${GTEST_DIR}/src/gtest-all.cc -o googletest.o
    RESULT_VARIABLE result
    WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
    )
if(result)
    message(FATAL_ERROR "g++ step for googletest failed: ${result}")
endif()

execute_process(COMMAND ar -rv googletest/googletest.a googletest.o
    RESULT_VARIABLE result
    WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
    )
if(result)
    message(FATAL_ERROR "ar step for googletest failed: ${result}")
endif()
