# SimpleUtil

node-server常用的工具函数

## install

```
npm i @dp/simple-util --save
```


## API

### once(fn)

返回一个新函数，多次调用fn只被执行一次，并且返回同一个值
可以用来包装某些只能被执行一次的初始化函数

- param {function} fn , fn可以是普通函数，也可以值async函数

> 注意，fn执行的时候this都会被设置为null，如果你在fn中使用this,请自行用箭头函数或者bind方法保证内部this

```javascript
// 这个方法只会被执行一次
let fn = () => 1
let onceFn = once(fn)
let v1 = onceFn()
let v2 = onceFn()
// v1 , v2 都为1


// 包装class的实例方法
class A{
    constructor(){
        this.x = 1
        this.init = once(this._init.bind(this))
    }
    _init(){
        this.x++
    }
}
let a = new A()
a.init()
a.init()
// a.x === 2
```

### interval(fn,time,isImmediate)

创建一个定时器，每个`time`秒执行一次`fn`,如果`isImmediate`为true,则会立刻执行一次,否则会在`time`秒后第一次执行. 返回一个`Timer`对象，可以调用pause和resume方法控制暂停和恢复执行

*这里的每隔n秒，实际指的是在执行成功后等待n秒后再执行，尤其当fn是async函数，并且有长时间的异步操作时，间隔会明显变长*

#### Timer.pause()
暂停定时器
#### Timer.resume(isImmediate)
恢复定时器，如果`isImmediate`为true,则会立刻执行一次，否则在`time`秒后执行

```javascript
let fn = ()=>{}
// 立刻执行fn，并且每个1s执行一次
let timer = interval(fn,1,true)
// 暂停
timer.pause()

// 恢复
timer.resume()

```
