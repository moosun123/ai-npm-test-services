#include <napi.h>
#include <string>
#include <stdio.h>
#include "kms_lib.h"

using Napi::Function;
using Napi::String;
using Napi::Number;
using Napi::Env;

using std::string;

static Napi::String GetKeyByName(const Napi::CallbackInfo &info) {
    Napi::Env env = info.Env();
    string appKey = info[0].As<String>();
    string name = info[1].As<String>();
    int i = info[2].As<Number>();

    string res = appKey; 
    #ifdef linux  // Linux下调用kms
        res = getKeyByName(appKey, name, i);
    #endif
    return String::New(env, res);
}

static Napi::Object Init(Napi::Env env, Napi::Object exports) {
    exports.Set(String::New(env, "getKeyByName"), Function::New(env, GetKeyByName));
    return exports;
}

NODE_API_MODULE(node_kms, Init)
