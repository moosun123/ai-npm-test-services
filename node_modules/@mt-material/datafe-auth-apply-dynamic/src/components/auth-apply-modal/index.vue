<template>
  <mtd-modal class="__jiangjunling_auth_apply_modal" v-bind="modalProps" :visible="view" @close="handleHide">
    <div slot="title" class="auth-modal-header">
      <img
        class="header-logo"
        @click="handleJump"
        src="//s3plus.sankuai.com/v1/mss_c967219e66d442fc9cef1b3dfa9accfa/material/%E5%B0%86%E5%86%9B%E4%BB%A4logo%402x.png"
      />
      <span class="name" @click="handleJumpUse">将军令-权限申请</span>
    </div>
    <ContextModal :visible.sync="showContext" :data="showContextNode" />
    <div slot="default" class="auth-modal-body">
      <CheckApply
        v-if="viewCheckApply"
        :env="env"
        :loading="checkLoading"
        :system="params.system"
        :processList="progressList"
      />
      <div v-if="depDataStatus !== 'error'" v-show="!viewCheckApply">
        <div class="user-view-wrap">
          <UserView :userName="params.userName" :userId="params.misId" />
        </div>
        <div class="tree-selector-wrap">
          <div class="tree-selector-title">
            <span class="title">申请资源</span>
            <div class="search-input-wrap">
              <input type="text" v-model="query" placeholder="搜索资源" class="search-input" @keydown="handleKeyDown" />
              <span class="num-span" v-if="query">{{ findIndex + 1 }}/{{ searchKeys.length }}</span>
              <span class="mtdicon mtdicon-error-o" v-if="query" @click="query = ''"></span>
              <div class="auth-apply-icon-wrap">
                <i class="mtdicon mtdicon-up auth-apply-mtdicon-up" @click="handleToggleSearch('up')"></i>
                <i class="mtdicon mtdicon-down auth-apply-mtdicon-down" @click="handleToggleSearch('down')"></i>
              </div>
            </div>
          </div>
          <div class="tree-wrap">
            <TableTree
              v-if="data.length"
              ref="tableTree"
              :tree="data"
              :option="option"
              :loading="treeLoading"
              checkable
              :expand-keys.sync="authApplyModal.expandKeys"
              :checked-keys.sync="authApplyModal.checkedKeys"
              :load-data="false"
              :treeDisabled="treeDisable"
            >
              <template #default="{ treeNode, treeNode: { $origin_data } }">
                <span class="tree-content">
                  <mtd-tooltip placement="top" :content="treeNode.title">
                    <text-highlight :queries="[query]">{{ treeNode.title }}</text-highlight>
                  </mtd-tooltip>
                </span>
                <div v-if="$origin_data.isBind === '1'" style="margin-left: 5px">
                  <mtd-tooltip placement="top">
                    <template #content>
                      <span style="white-space: pre-line">{{ $origin_data.bindReport }}</span>
                    </template>
                    <mtd-tag theme="orange">关联</mtd-tag>
                  </mtd-tooltip>
                </div>
                <div v-if="$origin_data.hasAllAuth" style="margin-left: 5px">
                  <mtd-tag theme="green">已有全部权限</mtd-tag>
                </div>
                <div v-if="$origin_data.hasPartAuth" style="margin-left: 5px">
                  <mtd-tag theme="gray">已有部分权限</mtd-tag>
                </div>
                <div v-if="treeNode.level === 1" style="margin-left: 5px">
                  <a
                    v-if="$origin_data.withGraphic"
                    href="javascript: void(0)"
                    @click.stop="() => handleShowContextId($origin_data)"
                  >
                    图文信息
                  </a>
                </div>
              </template>
            </TableTree>
          </div>
        </div>
        <div class="valid-tiem-wrap">
          <ValidTimeSelect :expireTime.sync="expireTime" />
        </div>
        <div class="apply-reason-wrap">
          <ApplyReason ref="applyReason" :reason.sync="reason" />
        </div>
      </div>
      <div class="apply-error-status" v-else-if="depDataStatus === 'error'">
        <div class="apply-error-header" v-if="errorDetail.referer === 'SC_WEB'">接口登录处理异常</div>
        <div class="apply-error-header" v-else>资源不允许用户申请</div>
        <div class="apply-error-content">
          <template v-if="errorDetail.type !== ERROR_TYPES.UNKNOWN_ERR">
            {{ errorDetail.message }}
          </template>
          <template v-else-if="errorDetail.type === ERROR_TYPES.UNKNOWN_ERR">
            <div>{{ errorDetail.message }}</div>
            <div v-if="badResourceCodeName.length">
              <div v-for="item in badResourceCodeName" :key="item">{{ item }}</div>
            </div>
            <div v-else>
              点击下方"
              <b>跳转到将军令申请</b>
              "按钮继续申请操作
            </div>
            <!-- 以下仅针对开发者 -->
            <p class="jjl-small" v-if="env !== 'production'">
              (
              <a href="https://km.sankuai.com/page/1222580055" target="_blank">为什么会出现当前现象？</a>
              )
            </p>
          </template>
        </div>
      </div>
    </div>
    <div slot="footer" class="btn-wrap">
      <!-- 检测到重复申请时，提供申请其它资源的按钮 -->
      <mtd-button v-if="btnVisibleStatus.applyAnotherSource" :size="btnSize" type="primary" @click="handleHideCheck">
        申请其它资源
      </mtd-button>
      <!-- 依赖资源加载失败时出现该按钮 -->
      <mtd-button v-if="btnVisibleStatus.feedbackProblem" :size="btnSize" type="warning" @click="handleHide">
        确认
      </mtd-button>
      <!-- 但出现网络等异常问题时，出现该按钮（资源异常不出现） -->
      <mtd-button v-if="btnVisibleStatus.jumpToApply" :size="btnSize" type="primary" @click="handleJumpOrigin">
        跳转到将军令申请
      </mtd-button>
      <mtd-button
        v-if="btnVisibleStatus.submit"
        :size="btnSize"
        type="primary"
        :loading="isSubmitLoading"
        @click="handleSubmit"
      >
        {{ submitText }}
      </mtd-button>
    </div>
  </mtd-modal>
</template>

<script>
import UserView from '../user-select/index.vue';
import ValidTimeSelect from '../valid-time-select/Index.vue';
import ApplyReason from '../apply-reason/Index.vue';
import { DATA_REPORT_CID } from '../../utils/dataReport.js';
import scFunction from '../../utils/scWeb.js';
import ContextModal from './context-modal.vue';
import CheckApply from './check-apply.vue';
import { debounce } from '../../utils/index.js';
import AuthApplyModel from './model/model';
import TableTree from '../TableTree/Index.vue';
import TextHighlight from 'vue-text-highlight';

const ERROR_TYPES = {
  NO_ERROR: 0,
  // 依赖数据错误（已加载）
  DEP_DATA_ERR: 1,
  // 申请数据异常
  APPLY_RES_ERR: 2,
  // 参数异常
  PARAMS_ERR: 3,
  // 未知异常
  UNKNOWN_ERR: 4
};

export default {
  name: 'AuthApplyCore',
  components: {
    UserView,
    TableTree,
    ValidTimeSelect,
    ApplyReason,
    ContextModal,
    CheckApply,
    TextHighlight
  },
  props: {
    params: {
      type: Object,
      defalut: {}
    },
    viewModel: {
      type: Boolean,
      defalut: false
    },
    btnSize: {
      type: String
    },
    env: {
      type: String
    },
    treeDisable: {
      type: Boolean,
      defalut: false
    },
    modalProps: {
      type: Object,
      defalut: () => ({})
    },
    checkedAlreadyHaveAuth: {
      type: Boolean,
      defalut: false
    }
  },
  data() {
    return {
      view: false,
      data: [],
      treeLoading: false,
      loading: false,
      expireTime: '6m',
      reason: '',
      isSubmitLoading: false,
      errrMessage: '',
      errorDetail: {
        type: ERROR_TYPES.NO_ERROR
      },
      // 依赖的数据加载状态
      depDataStatus: 'loading',
      startTime: 0,
      requestTimes: 0,
      showContext: false,
      showContextNode: {},
      progressList: [],
      viewCheckApply: true,
      checkLoading: true,
      ERROR_TYPES,
      initTimeoutTimer: 0,
      query: '',
      findIndex: -1,
      searchKeys: [],
      badResourceCodeName: [],
      option: {
        height: '210px', // 滚动容器的高度
        itemHeight: 35, // 单个item的高度
        treeLeftWidth: '100%'
      },
      authApplyModal: new AuthApplyModel({})
    };
  },
  watch: {
    viewModel: {
      handler: function (val) {
        if (val) {
          setTimeout(() => {
            this.view = true;
          }, 300);
          // 开始计算授权操作流程时间
          this.startTime = new Date().getTime();
          const { system, resourceCode, childRC, viewType, misId, checkedAlreadyHaveAuth } = this.params;
          this.authApplyModal = new AuthApplyModel({
            system,
            resourceCodeList: resourceCode,
            childRCList: childRC,
            viewType,
            requireId: misId,
            checkedAlreadyHaveAuth
          });
          this.loadTree();
        } else {
          this.initTimeoutTimer && clearTimeout(this.initTimeoutTimer);
        }
      },
      immediate: true
    },
    query(val) {
      this.findIndex = -1;
      if (val) {
        this.handleQuery(val);
      } else {
        const ref = this.$refs.tableTree.getTreeRef();
        const flatData = ref.flatData;
        flatData.forEach(data => {
          data.active = false;
        });
      }
    }
  },
  computed: {
    submitText() {
      if (this.isSubmitLoading) {
        return '';
      } else if (this.viewApplyMore || this.viewCheckApply) {
        return '确认';
      } else {
        return '提交';
      }
    },
    treeParams: {
      get() {
        return {
          ...this.params
        };
      }
    },
    viewApplyMore: {
      get() {
        if (!this.viewCheckApply) {
          return false;
        }
        const { progressList, params } = this;
        return progressList.length && progressList.length < params.resourceCode.length;
      },
      set() {
        // 此处原逻辑占位，暂时先不做修改
      }
    },
    btnVisibleStatus() {
      return {
        applyAnotherSource: this.viewApplyMore,
        feedbackProblem: this.depDataStatus === 'error' && this.errorDetail.type !== ERROR_TYPES.PARAMS_ERR,
        jumpToApply: this.errorDetail && this.errorDetail.type === ERROR_TYPES.UNKNOWN_ERR,
        submit: this.depDataStatus === 'success' && !this.viewApplyMore
      };
    }
  },
  methods: {
    handleQuery: debounce(function (val) {
      const ref = this.$refs.tableTree.getTreeRef();
      const flatData = ref.flatData;
      const expandKeys = [];
      flatData.forEach(data => {
        if (data.title.includes(val)) {
          expandKeys.push(data.id);
        }
      });
      this.authApplyModal.expandKeys = expandKeys;
      this.searchKeys = expandKeys;
      this.$nextTick(() => {
        this.handleToggleSearch('down');
      });
    }, 300),
    handleToggleSearch(type) {
      const ref = this.$refs.tableTree.getTreeRef();
      const flatData = ref.flatData;
      // 获取最大滚动距离
      const maxScrollTop = 35 * flatData.filter(data => data.visible).length - 210;
      if (type === 'down') {
        this.findIndex++;
        if (this.findIndex === this.searchKeys.length) {
          this.findIndex = 0;
        }
      } else {
        if (this.findIndex === 0) {
          return;
        }
        this.findIndex -= 1;
      }
      const index = flatData
        .filter(data => data.visible)
        .findIndex(data => data.id === this.searchKeys[this.findIndex]);
      // 超过最大滚动，则保持最大滚动距离
      ref.updateVisibleData(index * 35 >= maxScrollTop ? maxScrollTop : index * 35);
      flatData.forEach(data => {
        data.active = false;
        if (data.id === this.searchKeys[this.findIndex]) {
          data.active = true;
        }
      });
    },
    handleKeyDown(e) {
      if (this.query && e.keyCode === 13) {
        this.handleToggleSearch('down');
      }
    },
    loadTree() {
      this.errorDetail = {
        type: ERROR_TYPES.NO_ERROR
      };
      this.depDataStatus = 'loading';
      this.treeLoading = true;
      this.errrMessage = '';
      const { resourceCode, childRC, misId, viewType } = this.params;
      const scFetch = scFunction(this.env);
      const treeLoadTasks = resourceCode.map(item => {
        if (!item || !misId) {
          return Promise.reject({
            type: ERROR_TYPES.PARAMS_ERR,
            referer: 'AUTH_CORE',
            message: '缺少必要的参数，请联系系统管理员（申请人和申请资源为必填参数）'
          });
        }
        return scFetch.fetch({
          url: '/permApply/showApplyingTree', // 只填写接口地址，最终SDK会把请求发送到：service-component.sankuai.com/sc-proxy/+你的接口地址
          method: 'GET',
          params: {
            resourceCode: item,
            requiredType: 0,
            requiredId: misId,
            // 历史原因必传，后续接口下线更新后修改
            applyId: 12345
          }
        });
      });
      Promise.all(treeLoadTasks)
        .then(resGroups => {
          const errorRes = resGroups.find(res => res.status !== 200 || !res.data || res.data.status !== 200);
          if (errorRes) {
            this.depDataStatus = 'error';
            this.viewCheckApply = false;
            this.errorDetail = {
              type: ERROR_TYPES.DEP_DATA_ERR,
              referer: 'AUTH_CORE',
              message: errorRes.data.message || '数据错误，请稍后再试'
            };
            return;
          }

          // Step 1. 先初步处理数据，同时记录全部的子节点 code name 子节点个数等
          this.data = this.authApplyModal
            .initTreeData(resGroups.map(res => res.data && res.data.content))
            .map(item => item[0]);
          const reasonArr = [];
          this.data.forEach(item => {
            const { ext } = item;
            !reasonArr.includes(ext.AR) && reasonArr.push(ext.AR);
          });
          this.reason = reasonArr.join('\n');

          const { allChildNameList, allChildRCList } = this.authApplyModal;
          childRC &&
            childRC.forEach(key => {
              if (key && !allChildNameList.includes(key) && !allChildRCList.includes(key)) {
                !this.badResourceCodeName.includes(key) && this.badResourceCodeName.push(key);
              }
            });
          if (this.badResourceCodeName.length) {
            this.depDataStatus = 'error';
            this.viewCheckApply = false;
            this.errorDetail = {
              type: ERROR_TYPES.UNKNOWN_ERR,
              referer: 'AUTH_CORE',
              message: `参数含以下无效资源 Code，如有异议请联系资源所属系统之负责人：`
            };
            return;
          }

          // Step 2.依赖数据都加载成功后，继续处理后续流程
          this.depDataStatus = 'success';
          this.treeLoading = false;
          // 查询是否有重复申请的资源
          this.$nextTick(() => {
            // 通过树组件拿到最新的数据，更新已选择的数据
            const treeData = this.$refs.tableTree.getTreeRef().getTreeData();
            const cacheTreeData = this.authApplyModal.formatSubmitData(treeData, viewType === 'selectNull');
            scFetch
              .fetch({
                url: '/permApply/apply-check', // 只填写接口地址，最终SDK会把请求发送到：service-component.sankuai.com/sc-proxy/+你的接口地址
                method: 'POST',
                data: {
                  nodes: cacheTreeData,
                  misId: misId
                }
              })
              .then(
                res => {
                  if (res.status && res.status === 200 && res.data && res.data.content) {
                    this.progressList = res.data.content;
                    this.viewCheckApply = res.data.content.length > 0;
                    this.checkLoading = false;
                    this.errrMessage = '';
                  } else {
                    return Promise.reject({
                      type: ERROR_TYPES.PARAMS_ERR,
                      referer: 'AUTH_CORE',
                      message: res.data.message
                    });
                  }
                },
                err => {
                  return Promise.reject({
                    type: ERROR_TYPES.PARAMS_ERR,
                    referer: 'AUTH_CORE',
                    message: err.message
                  });
                }
              )
              .catch(error => {
                // 针对非上述核心逻辑报错，构建标准化的异常类型
                this.errorHandler(error);
              });
          });
        })
        .catch(error => {
          // 针对非上述核心逻辑报错，构建标准化的异常类型
          this.errorHandler(error);
        });
    },

    errorHandler(err) {
      let error = err;
      if (error && error.action === 'callReloginBySC') {
        error = {
          type: ERROR_TYPES.UNKNOWN_ERR,
          referer: 'SC_WEB',
          message: '接口登录处理异常，请访问 https://km.sankuai.com/collabpage/1483488328'
        };
      }
      // 针对非上述核心逻辑报错，构建标准化的异常类型
      else if (!error || error.referer !== 'AUTH_CORE') {
        error = {
          type: ERROR_TYPES.UNKNOWN_ERR,
          referer: 'AUTH_CORE',
          message: (error && error.message) || '资源不允许用户申请'
        };
      }
      this.errorDetail = error;
      this.$mtd.message({
        message: error.message,
        type: 'error',
        dangerouslyUseHTMLString: true
      });
      this.data = [];
      this.depDataStatus = 'error';
      this.treeLoading = false;
      this.viewCheckApply = false;
      this.checkLoading = false;
      this.$emit('initFail');

      window.DataReportSDK['auth-user'].run(
        'moduleView',
        'b_techportal_69bzy4nc_mv',
        {
          custom: {
            system: this.params && this.params.system
          }
        },
        {
          cid: DATA_REPORT_CID
        }
      );
    },

    handleJumpOrigin() {
      const { env, params } = this;
      const { system, resourceCode, childRC, viewType, misId } = params;
      this.handleClean();
      this.view = false;
      setTimeout(() => {
        this.$emit('update:viewModel', false);
      }, 300);
      let fetchUrl = 'http://localhost:7070';
      switch (env) {
        case 'development':
          fetchUrl = 'http://auth.bi.dev.sankuai.com/apply';
          break;
        case 'test':
          fetchUrl = 'http://auth.bi.test.sankuai.com/apply';
          break;
        case 'staging':
          fetchUrl = 'http://auth.bi.st.sankuai.com/apply';
          break;
        case 'production':
          fetchUrl = 'https://auth.sankuai.com/apply';
          break;
      }
      const urlParams = `?system=${system || ''}&resourceCode=${resourceCode || ''}&childRC=${childRC || ''}&viewType=${
        viewType || ''
      }&userId=${misId || ''}`;
      window.open(fetchUrl + urlParams);
      window.DataReportSDK['auth-user'].run(
        'moduleView',
        'b_techportal_0448l3aq_mc',
        {
          custom: {
            system
          }
        },
        {
          cid: DATA_REPORT_CID
        }
      );
    },

    handleShowContextId(val) {
      const { env, params } = this;
      const { system } = params;
      const scFetch = scFunction(env);
      scFetch
        .fetch({
          url: `/resource/${val.resourceCode}/detail`, // 只填写接口地址，最终SDK会把请求发送到：service-component.sankuai.com/sc-proxy/+你的接口地址
          method: 'GET',
          params: {
            system
          }
        })
        .then(
          res => {
            const { content, status, message } = res.data || {};
            if (status === 200) {
              this.showContext = true;
              this.showContextNode = content;
            } else {
              this.$mtd.message({
                message: message || '权限申请错误，请稍后再试',
                type: 'error',
                dangerouslyUseHTMLString: true
              });
            }
          },
          err => {
            console.warn(err);
          }
        );
    },

    handleSubmit() {
      if (this.viewCheckApply) {
        const { system } = this.params;
        window.DataReportSDK['auth-user'].run(
          'moduleClick',
          'b_techportal_xyjwsh7v_mc',
          {
            custom: {
              system
            }
          },
          {
            cid: DATA_REPORT_CID
          }
        );
        this.handleClean();
        this.view = false;
        setTimeout(() => {
          this.$emit('update:viewModel', false);
        }, 300);
        return;
      }
      if (!this.reason) {
        this.$mtd.message({
          message: '请确认已勾选需要申请的资源，并填写申请理由',
          type: 'error'
        });
        if (this.$refs.applyReason && this.$refs.applyReason.$refs && this.$refs.applyReason.$refs.text) {
          this.$refs.applyReason.$refs.text.focus();
        }
        return;
      }
      const { misId } = this.params;
      // 上报申请整个流程的时间
      window.DataReportSDK['auth-user'].run(
        'moduleClick',
        'b_techportal_xkx8z4s2_mc',
        {
          custom: {
            misId: misId,
            mode: 'component',
            time: (new Date().getTime() - this.startTime) / 1000
          }
        },
        {
          cid: DATA_REPORT_CID
        }
      );
      const {
        params,
        params: { system },
        expireTime,
        reason,
        env
      } = this;
      // 通过树组件拿到最新的数据，更新已选择的数据
      const treeData = this.$refs.tableTree.getTreeRef().getTreeData();
      const cacheTreeData = this.authApplyModal.formatSubmitData(treeData);
      if (this.authApplyModal.checkedKeys.length) {
        this.isSubmitLoading = true;
        window.DataReportSDK['auth-user'].run(
          'moduleClick',
          'b_techportal_54kkkwjw_mc',
          {
            custom: {
              system
            }
          },
          {
            cid: DATA_REPORT_CID
          }
        );
        const scFetch = scFunction(env);
        scFetch
          .fetch({
            url: '/permApply/create', // 只填写接口地址，最终SDK会把请求发送到：service-component.sankuai.com/sc-proxy/+你的接口地址
            method: 'POST',
            data: {
              applicant: {
                type: 0,
                requireId: params.misId
              },
              period: expireTime,
              reason: reason,
              // 历史原因必传，后续接口下线更新后修改
              trees: cacheTreeData
            }
          })
          .then(
            res => {
              const resData = res.data || {};
              if (resData.status === 200) {
                window.DataReportSDK['auth-user'].run(
                  'moduleClick',
                  'b_techportal_yom9e8vt_mv',
                  {
                    custom: {
                      system
                    }
                  },
                  {
                    cid: DATA_REPORT_CID
                  }
                );
                this.$mtd.message({
                  icon: 'mtdicon-success-circle',
                  message: '权限申请成功，请等待管理员审批',
                  type: 'success'
                });
                this.handleClean();
                this.$emit('success');
                this.view = false;
                setTimeout(() => {
                  this.$emit('update:viewModel', false);
                }, 300);
              } else {
                this.$mtd.message({
                  message: resData.message || '权限申请错误，请稍后再试',
                  type: 'error',
                  dangerouslyUseHTMLString: true
                });
                this.$emit('fail');
              }
              this.isSubmitLoading = false;
            },
            err => {
              this.isSubmitLoading = false;
              window.DataReportSDK['auth-user'].run(
                'moduleClick',
                'b_techportal_f3nqdnlb_mv',
                {
                  custom: {
                    system
                  }
                },
                {
                  cid: DATA_REPORT_CID
                }
              );
              this.$mtd.message({
                message: err.message || '权限申请错误，请稍后再试',
                type: 'error',
                dangerouslyUseHTMLString: true
              });
              this.$emit('fail');
            }
          );
      } else {
        this.$mtd.message({
          message: '请勾选需要申请的资源',
          type: 'warning'
        });
      }
    },

    handleJump() {
      const { system } = this.params;
      window.DataReportSDK['auth-user'].run(
        'moduleClick',
        'b_techportal_40fu7481_mc',
        {
          custom: {
            system
          }
        },
        {
          cid: DATA_REPORT_CID
        }
      );
      window.open('https://km.sankuai.com/page/163845980');
    },

    handleJumpUse() {
      const { system } = this.params;
      window.DataReportSDK['auth-user'].run(
        'moduleClick',
        'b_techportal_ta8lc38z_mc',
        {
          custom: {
            system
          }
        },
        {
          cid: DATA_REPORT_CID
        }
      );
      window.open('https://km.sankuai.com/page/309419273');
    },

    handleClean() {
      this.data = [];
      this.treeLoading = false;
      this.loading = false;
      this.expireTime = '6m';
      this.reason = '';
      this.isSubmitLoading = false;
      this.startTime = 0;
      this.requestTimes = 0;
      this.showContext = false;
      this.showContextNode = {};
      this.progressList = [];
      this.viewCheckApply = true;
      this.checkLoading = true;
      this.query = '';
    },

    handleHideCheck() {
      const codeList = this.progressList.map(item => {
        return item.resourceCode;
      });
      this.data = this.data.filter(item => {
        return !codeList.includes(item[0].code);
      });
      this.viewApplyMore = false;
      this.viewCheckApply = false;
    },

    handleHide() {
      const { system } = this.params;
      window.DataReportSDK['auth-user'].run(
        'moduleClick',
        'b_techportal_xyjwsh7v_mc',
        {
          custom: {
            system
          }
        },
        {
          cid: DATA_REPORT_CID
        }
      );
      this.handleClean();
      this.view = false;
      setTimeout(() => {
        this.$emit('update:viewModel', false);
      }, 300);
    }
  },
  beforeDestroy() {
    this.initTimeoutTimer && clearTimeout(this.initTimeoutTimer);
  }
};
</script>
<style lang="scss">
.__jiangjunling_auth_apply_modal {
  position: relative;
  font-size: 13px;
  .mtd-modal {
    min-width: 0;
  }
  .mtd-modal-header {
    padding: 0;
  }
  .jjl-small {
    font-size: 12px;
    color: #999;
    a {
      color: inherit;
      text-decoration: none;
    }
  }
  .auth-modal-header {
    color: #333;
    padding: 11px 20px;
    border-bottom: 1px solid #eaeaea;
    .header-logo {
      width: 100px;
      position: relative;
      top: 6px;
      width: 24px;
      height: 24px;
      cursor: pointer;
    }
    .name {
      margin-left: 9px;
      font-size: 16px;
      color: rgba(0, 0, 0, 0.87);
      cursor: pointer;
    }
    .name:hover {
      color: #4e73ff;
    }
  }
  .mtd-modal-footer {
    height: 50px;
    .view-checked {
      cursor: pointer;
    }
    .btn-wrap {
      line-height: 50px;
      & > :last-child {
        margin-left: 10px;
      }
    }
  }
  .auth-modal-body {
    .user-view-wrap {
      margin-top: 20px;
    }
    .apply-error-status {
      margin: 20px 0;
      background-color: #ffeeee;
      padding: 10px;
      border-radius: 4px;
      .apply-error-header {
        padding: 5px 0;
        font-weight: bold;
        border-bottom: 1px solid #ffdddd;
      }
      .apply-error-content {
        margin-top: 5px;
      }
    }
    .tree-selector-wrap {
      margin-top: 20px;
      .tree-selector-title {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        .title {
          color: rgba(0, 0, 0, 0.65);
        }
      }
      .tree-wrap {
        border-top: 1px solid rgba($color: #000000, $alpha: 0.1);
        border-bottom: 1px solid rgba($color: #000000, $alpha: 0.1);
        .tree-content {
          margin-left: 5px;
        }
      }
    }
    .valid-tiem-wrap,
    .apply-reason-wrap {
      margin-top: 20px;
    }
    .apply-reason {
      font-size: 13px;
      color: rgba(0, 0, 0, 0.65);
      .apply-reason-title {
        margin-bottom: 2px;
      }
    }
    .login-model {
      .iframe {
        width: 0px;
        height: 0px;
        border: 0;
      }
    }
    .iframe-quest {
      width: 100%;
      height: 100%;
      .iframe {
        width: 0px;
        height: 0px;
        border: 0;
      }
    }
    .user-view-wrap {
      font-size: 13px;
      color: rgba(0, 0, 0, 0.65);
      .user-select-title {
        margin-bottom: 9px;
      }
    }
    .valid-time-select {
      font-size: 13px;
      color: rgba(0, 0, 0, 0.65);
      .valid-time-title {
        margin-bottom: 8px;
      }
      .radio-wrap {
        .mtd-radio-text {
          padding-right: 30px;
          font-size: 13px;
          color: rgba(0, 0, 0, 0.84);
        }
      }
    }
    .search-input-wrap {
      width: 243px;
      position: relative;
      color: rgba(0, 0, 0, 0.65);
      .search-input {
        width: 200px;
        height: 24px;
        outline-style: none;
        border: 1px solid rgba(0, 0, 0, 0.12);
        border-right: none;
        border-radius: 3px 0 0 3px;
        padding-left: 5px;
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        color: rgba(0, 0, 0, 0.65);
        box-sizing: border-box;
      }
      > * {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
      }
      .num-span {
        right: 60px;
      }
      .mtdicon-error-o {
        right: 45px;
        cursor: pointer;
        font-size: 14px;
      }
      .auth-apply-icon-wrap {
        width: 43px;
        right: 0;
        height: 24px;
        line-height: 24px;
        border: 1px solid rgba(0, 0, 0, 0.12);
        border-radius: 0 3px 3px 0;
        background: #f5f5f5;
        display: flex;
        justify-content: space-around;
        align-items: center;
        box-sizing: border-box;
        .auth-apply-mtdicon-up,
        .auth-apply-mtdicon-down {
          cursor: pointer;
        }
      }
    }
  }
}
</style>
