<template>
    <div class="selector-container">
        <mtd-select v-model="value.type" @change="typeChanged" style="width: 100px">
            <mtd-option
                v-for="item in typeOptions"
                :key="item.value"
                :label="item.label"
                :value="item.value"
            />
        </mtd-select>
        <mtd-select v-model="value.labelId" @change="labelIdChanged" style="width: 200px">
            <mtd-option
                v-for="item in keysOptions"
                :key="item.value"
                :label="item.label"
                :value="item.value"
            />
        </mtd-select>
        <template v-if="showBehavior">
            <mtd-select v-model="value.operator" style="width: 200px">
                <mtd-option
                    v-for="item in behaviorOperate"
                    :key="item.value"
                    :label="item.label"
                    :value="item.value"
                />
            </mtd-select>
            <mtd-input v-model="value.value" placeholder="请输入" />
        </template>
        <template v-else>
            <mtd-select v-model="value.operator" style="width: 200px">
                <mtd-option
                    v-for="item in operate"
                    :key="item.value"
                    :label="item.label"
                    :value="item.value"
                />
            </mtd-select>
            <mtd-select v-model="selectedValues" multiple clearable style="width: 200px">
                <mtd-option
                    v-for="item in selectValuesOptions"
                    :key="item.value"
                    :label="item.label"
                    :value="item.value"
                />
            </mtd-select>
        </template>
    </div>
</template>
<script lang="ts">
import { Vue, Component, Prop } from 'vue-property-decorator';
@Component
export default class UaCondition extends Vue {
    @Prop({
        type: Object,
        default: () => {
            return {};
        },
    })
    private value;

    private typeOptions = [
        {
            label: '用户是',
            value: 1,
        },
        {
            label: '用户做过',
            value: 2,
        },
    ];

    private get keysOptions() {
        const obj = {
            1: [
                {
                    label: '属相',
                    value: '01',
                },
                {
                    label: '优惠敏感度',
                    value: '02',
                },
                {
                    label: '用户类型',
                    value: '03',
                },
                {
                    label: '是否登录',
                    value: '04',
                },
            ],
            2: [
                {
                    label: '登录',
                    value: '21',
                },
                {
                    label: '浏览',
                    value: '22',
                },
                {
                    label: '下单',
                    value: '32',
                },
                {
                    label: '退款',
                    value: '42',
                },
            ],
        };
        return obj[this.value.type] || [];
    }

    private options = [
        {
            label: '属相',
            value: '01',
        },
        {
            label: '优惠敏感度',
            value: '02',
        },
        {
            label: '用户类型',
            value: '03',
        },
        {
            label: '是否登录',
            value: '04',
        },
    ];

    private operate = [
        {
            label: '=',
            value: '=',
        },
        {
            label: '包含',
            value: 'in',
        },
        {
            label: '不包含',
            value: 'notin',
        },
    ];

    private behaviorOperate = [
        {
            label: '=',
            value: '=',
        },
        {
            label: '>',
            value: '>',
        },
        {
            label: '<',
            value: '<',
        },
    ];

    private get showBehavior() {
        return this.value.type === 2;
    }

    private get selectValuesOptions() {
        const obj = {
            '01': [
                {
                    label: '鼠',
                    value: '鼠',
                },
                {
                    label: '牛',
                    value: '牛',
                },
                {
                    label: '虎',
                    value: '虎',
                },
                {
                    label: '兔',
                    value: '兔',
                },
                {
                    label: '龙',
                    value: '龙',
                },
                {
                    label: '蛇',
                    value: '蛇',
                },
                {
                    label: '马',
                    value: '马',
                },
                {
                    label: '羊',
                    value: '羊',
                },
                {
                    label: '猴',
                    value: '猴',
                },
                {
                    label: '鸡',
                    value: '鸡',
                },
                {
                    label: '狗',
                    value: '狗',
                },
                {
                    label: '猪',
                    value: '猪',
                },
            ],
            '02': [
                {
                    label: '敏感度高',
                    value: '敏感度高',
                },
                {
                    label: '敏感度低',
                    value: '敏感度低',
                },
                {
                    label: '敏感度一般',
                    value: '敏感度一般',
                },
            ],
            '03': [
                {
                    label: '高频用户',
                    value: '高频用户',
                },
                {
                    label: '低频用户',
                    value: '低频用户',
                },
                {
                    label: '普通用户',
                    value: '普通用户',
                },
            ],
            '04': [
                {
                    label: '是',
                    value: '是',
                },
                {
                    label: '否',
                    value: '否',
                },
            ],
        };
        return obj[this.value.labelId] || [];
    }

    private get selectedValues() {
        const value = this.value.value;
        return value ? value.split(',') : [];
    }

    private set selectedValues(value: string[]) {
        this.value.value = value.join(',');
    }

    public validate() {
        return '';
    }

    private typeChanged() {
        this.value.labelId = null;
        this.value.operator = null;
        this.value.value = null;
    }

    private labelIdChanged() {
        this.value.operator = null;
        this.value.value = null;
    }
}
</script>
<style lang="scss" scoped>
.selector-container {
    > div {
        margin-right: 10px;
    }
}
</style>
