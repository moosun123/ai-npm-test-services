<template>
    <div>
        <MpaConditionExpression
            ref="expression"
            :conditionData="conditionData"
            @addCondition="addCondition"
            :showHeader="true"
        />
    </div>
</template>
<style></style>
<script lang="ts">
import { Vue, Component } from 'vue-property-decorator';
import MpaConditionExpression from '../../mpa-condition-expression.vue';
import UaSelector from '../../test/ua-selector.vue';
Vue.component(UaSelector.name, UaSelector);
@Component({
    components: {
        MpaConditionExpression,
    },
})
export default class Base extends Vue {
    private conditionData = {
        name: '',
        conditionType: 'or',
        childConditionList: [
            {
                name: '用户属性满足',
                conditionType: 'and',
                childConditionList: [
                    {
                        comp: 'test-condition',
                        data: {
                            key: '01',
                            operator: 'in',
                            value: '',
                        },
                    },
                    {
                        comp: 'test-condition',
                        data: {
                            key: '02',
                            operator: 'in',
                            value: '',
                        },
                    },
                ],
            },
            {
                name: '用户行为满足',
                conditionType: 'and',
                childConditionList: [
                    {
                        comp: 'ua-condition',
                        data: {
                            type: 2,
                            labelId: '22',
                            operator: '>',
                            value: '10',
                        },
                    },
                    {
                        comp: 'ua-condition',
                        data: {
                            type: 2,
                            labelId: '22',
                            operator: '>',
                            value: '10',
                        },
                    },
                ],
            },
            {
                name: '行为序列满足',
                conditionType: 'and',
                // childConditionList: [
                //     {
                //         comp: 'ua-condition',
                //         data: {
                //             type: 2,
                //             labelId: '32',
                //             operator: '>',
                //             value: '',
                //         },
                //     },
                //     {
                //         comp: 'ua-condition',
                //         data: {
                //             type: 2,
                //             labelId: '32',
                //             operator: '>',
                //             value: '',
                //         },
                //     },
                // ],
            },
        ],
    };
    private validate() {
        (this.$refs.expression as MpaConditionExpression).validate();
    }

    private addRootCondition() {
        (this.$refs.expression as MpaConditionExpression).addRootCondition({
            name(index = 0) {
                return `规则${index + 1}`;
            },
            conditionType: 'and',
            operatorList: ['add'],
        });
    }

    private addCondition({ name, comp, callback }) {
        const attrs = {
            comp: 'test-condition',
            data: {
                key: '01',
                operator: 'in',
                value: '',
            },
        };

        const behavior = {
            comp: 'ua-condition',
            data: {
                type: 2,
                labelId: '32',
                operator: '>',
                value: '',
            },
        };
        if (name === '用户属性满足') {
            callback(attrs);
        } else {
            callback(behavior);
        }
    }
}
</script>
<style lang="scss" scoped>
</style>
