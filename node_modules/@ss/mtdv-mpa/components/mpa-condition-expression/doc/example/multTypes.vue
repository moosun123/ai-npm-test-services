<template>
    <div>
        <MpaConditionExpression
            ref="expression"
            :conditionData="conditionData"
            :addChildButton="false"
            @addCondition="addCondition"
        >
            <template v-slot:addGroups>
                <mtd-button type="text" icon="mtdicon mtdicon-file-add-o" @click="addGroup('behavior')">添加行为</mtd-button>
                <mtd-button type="text" icon="mtdicon mtdicon-file-add-o" @click="addGroup('attr')">添加属性</mtd-button>
                <mtd-button type="text" icon="mtdicon mtdicon-file-add-o" @click="addGroup('group')">添加分群</mtd-button>
            </template>
        </MpaConditionExpression>
    </div>
</template>
<style></style>
<script lang="ts">
import { Vue, Component } from 'vue-property-decorator';
import MpaConditionExpression from '../../mpa-condition-expression.vue';
import TestCondition from '../../test/test-condition.vue';
import UaCondition from '../../test/ua-condition.vue';
import GroupCase from '../../test/group-case.vue';
Vue.component(TestCondition.name, TestCondition);
Vue.component(UaCondition.name, UaCondition);
Vue.component(GroupCase.name, GroupCase);
@Component({
    components: {
        MpaConditionExpression,
    },
})
export default class Base extends Vue {
    private disabled = false;
    private conditionOptions = [
        {
            label: '且',
            value: 'and',
        },
        {
            label: '或',
            value: 'or',
        },
    ];

    private props = {
        childConditionList: 'children',
        conditionType: 'cType',
    };
    private conditionData = {
        conditionType: 'or',
        childConditionList: [
            {
                conditionType: 'and',
                type: 'behavior',
                data: {
                    type: 2,
                    labelId: '21',
                    operator: '>',
                    value: '10',
                },
                operatorList: ['filters', 'delete'],
                comp: 'ua-condition',
                childConditionList: [
                    {
                        comp: 'test-condition',
                        data: {
                            key: '01',
                            operator: 'in',
                            value: '',
                        },
                    },
                    {
                        comp: 'test-condition',
                        data: {
                            key: '01',
                            operator: 'in',
                            value: '',
                        },
                    },
                ]
            },
            {
                conditionType: 'and',
                type: 'attr',
                comp: 'test-condition',
                operatorList: ['delete'],
                data: {
                    key: '01',
                    operator: 'in',
                    value: '',
                },
            },
            {
                conditionType: 'and',
                type: 'group',
                comp: 'group-case',
                data: {
                    id: 1
                },
            }
        ],
    };

    private addCondition({ name, comp, callback }) {
        callback({
            comp: 'test-condition',
            operatorList: ['delete'],
            data: {
                key: '01',
                operator: 'in',
                value: '',
            },
        });
    }

    private addGroup(type) {
        if (type === 'attr') {
            (this.$refs.expression as MpaConditionExpression).addRootCondition({
                type,
                data: {
                    key: '01',
                    operator: 'in',
                    value: '',
                },
                operatorList: ['filters', 'delete'],
                comp: 'test-condition',
            });
        } else if (type === 'behavior') {
            (this.$refs.expression as MpaConditionExpression).addRootCondition({
                type,
                data: {
                    type: 2,
                    labelId: '21',
                    operator: '>',
                    value: '10',
                },
                operatorList: ['filters', 'delete'],
                comp: 'ua-condition',
            });
        } else if (type === 'group') {
            (this.$refs.expression as MpaConditionExpression).addRootCondition({
                type,
                data: {
                    id: 1,
                },
                operatorList: ['delete'],
                comp: 'group-case',
            });
        }
    }
}
</script>
<style lang="scss" scoped>
.mtd-btn-text {
    color: #166FF7;
    font-size: 12px;
    padding-left: 0px;
}
</style>
