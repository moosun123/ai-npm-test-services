<template>
    <div class="condition-title-container">
        <template v-if="!contenteditable">
            <span class="expand-icon expand-icon-left">
                <i class= 'mtdicon' v-if="showExpand" :class="{'mtdicon-down-thick': isExpand, 'mtdicon-right-thick': !isExpand}" @click="expand"></i>
            </span>
            <div class="header-title" v-html="name">
            </div>
        </template>
        <template v-else>
            <span class="expand-icon expand-icon-left">
                <i class= 'mtdicon' v-if="showExpand" :class="{'mtdicon-down-thick': isExpand, 'mtdicon-right-thick': !isExpand}" @click="expand"></i>
            </span>
            <span class="chart-index">
                {{characterCode}}
            </span>
            <div class="title-content">
                <div class="header-title" v-if="!isEditing">{{name}}</div>
                <mtd-input ref="editTitle" v-model="editTitle" v-else placeholder="具体文案" @keydown.enter="enter" @blur="enter" />
            </div>
            <mtd-icon-button
                class="mpa-icon-button"
                size="small"
                type="secondary"
                icon="mtdicon mtdicon-edit-o"
                @click="edit"
                v-if="showLeftIcon">
            </mtd-icon-button>
            <mtd-icon-button
                class="mpa-icon-button"
                size="small"
                type="secondary"
                icon="mtdicon mtdicon-delete-o"
                @click="deleteItem"
                v-if="showLeftIcon">
            </mtd-icon-button>
        </template>
    </div>
</template>
<script lang="ts">
import { Component, Prop } from 'vue-property-decorator';
import props from '../mixin/props.vue';
import { mixins } from 'vue-class-component';
import { generateBigCharacter } from '../utils/index';
@Component
export default class ConditionTitle extends mixins(props) {
    @Prop({type: Boolean, default: false})
    private contenteditable;

    @Prop({type: Boolean, default: false})
    private showExpand;

    @Prop({type: Boolean, default: false})
    private isExpand;

    @Prop({type: String, default: ''})
    private name;

    @Prop({type: Number, default: 0})
    private index;

    private isEditing = false;

    private get characterCode() {
        return generateBigCharacter(this.index);
    }

    private get showLeftIcon() {
        return !this.disabled && !this.isEditing;
    }


    private edit() {
        this.isEditing = true;
        this.$nextTick(() => {
            (this.$refs.editTitle as any).focus();
        });
    }

    private expand() {
        this.$emit('update:isExpand', !this.isExpand);
    }

    private get editTitle() {
        return this.name;
    }

    private set editTitle(val) {
        this.$emit('editName', val);
    }

    private enter(event) {
        this.isEditing = false;
    }

    private deleteItem() {
        this.$emit('deleteItem');
    }

}
</script>
<style scoped lang="scss">
</style>
