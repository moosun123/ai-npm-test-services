<template>
    <div :class="[prefix + '-body', 'flex-row ', prefix + '-regions-wrapper']">
        <CityCategorySideBar
            v-for="item in sideBarConfig"
            :key="item.title"
            :multiple="item.multiple"
            :list="item.list"
            :title="item.title"
            :show-expand="item.showExpand"
            :select-any-level="selectAnyLevel"
            :show-select-all="item.enableSelectAll && showSelectAll"
            class="regions-aside-item"
        ></CityCategorySideBar>
    </div>
</template>
<script lang="ts">
import { Vue, Component, Prop, Inject } from 'vue-property-decorator';
import { ICustomOptionItem, ISideTitleInfo, ISideBarListItem, DataSourceType } from '../types';
import CityCategorySideBar from './CityCategorySideBar.vue';

@Component({
    components: {
        CityCategorySideBar,
    },
})
export default class CityRegionsCategory extends Vue {
    @Prop({
        type: Array,
        required: true,
    })
    data!: ICustomOptionItem[]; // 数据源

    @Prop({
        type: Boolean,
        required: true,
    })
    multiple!: boolean; // 是否支持多选

    @Prop({
        type: Number,
        required: true,
    })
    leafLevel!: number; // 叶子节点的层级

    @Prop({
        type: Boolean,
        required: true,
    })
    selectAnyLevel!: boolean; // 是否允许选择任意层级

    @Prop({
        type: Boolean,
        required: true,
    })
    showSelectAll!: boolean; // 是否显示全选按钮

    @Prop({
        type: String,
        required: true,
    })
    dataSourceType!: DataSourceType; // 数据源类型

    @Inject()
    private prefix!: string;

    private titleMaps: Record<string, ISideTitleInfo> = {
        regions: {
            sideBarTitle: '省份',
            gridTitle: '城市',
            gridSubTitle: '区县',
        },
        bussiness: {
            sideBarTitle: '业务大区',
            gridTitle: '省份',
            gridSubTitle: '城市',
        },
    };

    // 整体配置信息
    private get sideBarConfig() {
        const result: ISideBarListItem[] = [
            {
                multiple: this.multiple,
                title: this.secondaryInfo.sideBarTitle,
                list: this.data,
                showExpand: true,
                enableSelectAll: true,
            },
            {
                multiple: this.multiple,
                title: this.secondaryInfo.gridTitle,
                list: this.gridList,
                showExpand: this.leafLevel === 3,
                enableSelectAll: false,
            },
        ];
        if (this.leafLevel === 3) {
            result.push({
                multiple: this.multiple,
                title: this.secondaryInfo.gridSubTitle,
                list: this.gridSubList,
                showExpand: false,
                enableSelectAll: false,
            });
        }
        return result;
    }

    private get secondaryInfo() {
        return this.titleMaps[this.dataSourceType];
    }

    // 数据源
    private get gridList(): ICustomOptionItem[] {
        const selected: ICustomOptionItem = this.data.find(
            (node: ICustomOptionItem) => !!node.expand,
        ) as ICustomOptionItem;
        return selected ? (selected.children as ICustomOptionItem[]) : [];
    }

    private get gridSubList(): ICustomOptionItem[] {
        const selected: ICustomOptionItem = this.gridList.find(
            (node: ICustomOptionItem) => !!node.expand,
        ) as ICustomOptionItem;
        return selected ? (selected.children as ICustomOptionItem[]) : [];
    }
}
</script>
