<template>
    <div :class="[prefix + '-body', 'flex-row']">
        <CityCategorySideBar
            :multiple="multiple"
            :list="data"
            :title="secondaryInfo.sideBarTitle"
            :select-any-level="selectAnyLevel"
            :show-select-all="showSelectAll"
        ></CityCategorySideBar>
        <div :class="[prefix + '-level']">
            <CityCategoryGrid
                :multiple="multiple"
                :data="gridList"
                :show-checkbox="multiple"
                :title="secondaryInfo.gridTitle"
                :sub-title="secondaryInfo.gridSubTitle"
                :show-nav="showNavList"
                :select-any-level="selectAnyLevel"
                :show-select-all="false"
            ></CityCategoryGrid>
        </div>
    </div>
</template>
<script lang="ts">
import { Vue, Component, Prop, Inject } from 'vue-property-decorator';
import CityCategoryGrid from './CityCategoryGrid.vue';
import CityCategorySideBar from './CityCategorySideBar.vue';
import { ICustomOptionItem, ISideTitleInfo, DataSourceType } from '../types';

@Component({
    components: {
        CityCategoryGrid,
        CityCategorySideBar,
    },
})
export default class CityLevelCategory extends Vue {
    @Prop({
        type: Array,
        required: true,
    })
    // ICustomOptionItem 类型的数组，用于渲染组件的数据源
    data!: ICustomOptionItem[];

    @Prop({
        type: Boolean,
        required: true,
    })
    // 是否支持多选
    multiple!: boolean;

    @Prop({
        type: Number,
        required: true,
    })
    // 渲染组件的叶子节点的层级
    leafLevel!: number;

    @Prop({
        type: Boolean,
        required: true,
    })
    // 是否支持选择任意层级
    selectAnyLevel!: boolean;

    @Prop({
        type: Boolean,
        required: true,
    })
    // 是否显示全选按钮
    showSelectAll!: boolean;

    @Prop({
        type: String,
        required: true,
    })
    // 数据源类型，用于获取组件的附加信息
    dataSourceType!: DataSourceType;

    @Inject()
    private prefix!: string;

    private titleMaps: Record<string, ISideTitleInfo> = {
        regions: {
            sideBarTitle: '省份',
            gridTitle: '城市',
            gridSubTitle: '区县',
        },
        level: {
            sideBarTitle: '级别',
            gridTitle: this.leafLevel === 2 ? '' : '城市',
            gridSubTitle: this.leafLevel === 2 ? '城市' : '',
        },
        bussiness: {
            sideBarTitle: '业务大区',
            gridTitle: '省份',
            gridSubTitle: '城市',
        },
    };

    // 附加信息
    private get secondaryInfo() {
        return this.titleMaps[this.dataSourceType];
    }

    // 是否显示nav图层
    private get showNavList() {
        return this.leafLevel === 3;
    }

    // 数据源
    private get gridList() {
        const selected: ICustomOptionItem[] = this.data.filter(
            (node: ICustomOptionItem) => node.expand,
        ) as ICustomOptionItem[];
        // 确保CityCategoryGrid组件接收的是两层结构数据
        return selected.length ? (this.showNavList ? selected[0].children : selected) : [];
    }
}
</script>
