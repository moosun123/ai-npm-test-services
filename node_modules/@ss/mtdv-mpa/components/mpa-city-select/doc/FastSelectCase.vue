<template>
    <MpaCitySelect
        ref="fastSelect"
        :append-to-body="true"
        :value="selectedValue"
        :data-source-type="dataSourceType"
        @category-change="handleCategoryChange"
    >
        <template v-slot:recentView>
            <div class="self-recent-view">
                <span class="title">最近:</span>
                <div class="recent-view-list">
                    <span v-for="city in renderData" :key="city.value" @click="handleClick(city)">{{
                        city.label
                    }}</span>
                </div>
            </div>
        </template>
    </MpaCitySelect>
</template>
<style></style>
<script lang="ts">
import { Vue, Component, Ref } from 'vue-property-decorator';
import MpaCitySelect from '../index';
import { CityValueType, SelectedValueList, ICustomOptionItem } from '../types';

@Component({
    components: {
        MpaCitySelect,
    },
})
export default class FastSelectCase extends Vue {
    @Ref('fastSelect') fastSelectCom!: InstanceType<typeof MpaCitySelect>;

    private dataSourceType: string = 'regions';

    private selectedValue: SelectedValueList = [];

    private recentViewList: ICustomOptionItem[] = [
        {
            label: '安徽省',
            value: '340000',
            children: [
                {
                    label: '合肥市',
                    value: '340100',
                },
            ],
        },
        {
            label: '广东省',
            value: '440000',
            children: [
                {
                    label: '广州市',
                    value: '440100',
                },
            ],
        },
    ];

    private get renderData() {
        const result: ICustomOptionItem[] = [];
        this.recentViewList.forEach((provincen: ICustomOptionItem) => {
            result.push(...(provincen.children as ICustomOptionItem[]));
        });
        return result;
    }

    private handleCategoryChange(value: string) {
        // this.dataSourceType = value;
    }

    private handleClick(city: ICustomOptionItem) {
        const parent: ICustomOptionItem = this.recentViewList.find(
            (province: ICustomOptionItem) => {
                return (
                    (province.children as ICustomOptionItem[]).find(
                        (child: ICustomOptionItem) => child.value === city.value,
                    ) !== undefined
                );
            },
        ) as ICustomOptionItem;
        if (parent) {
            const result: CityValueType[] = [];
            result.push(parent.value);
            result.push(city.value);
            this.selectedValue = [result];
            if (this.fastSelectCom) {
                this.fastSelectCom.blur();
            }
        }
    }
}
</script>
<style lang="scss" scoped>
.self-recent-view {
    display: flex;

    .title {
        font-weight: 400;
        font-family: PingFangSC-Regular;
        font-size: 14px;
        color: rgba(0, 0, 0, 0.5);
        line-height: 22px;
        margin-right: 16px;
    }

    .recent-view-list {
        display: flex;
        flex-wrap: wrap;

        span {
            font-weight: 400;
            font-family: PingFangSC-Regular;
            font-size: 14px;
            color: #166ff7;
            line-height: 22px;
            margin-right: 16px;
            cursor: pointer;

            &:last-child {
                margin-right: 0;
            }
        }
    }
}
</style>
