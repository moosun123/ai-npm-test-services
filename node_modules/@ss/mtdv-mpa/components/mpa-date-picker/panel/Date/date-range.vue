<template>
  <div :class="classes">
    <div :class="[panelPrefix + '-sidebar']" v-if="shortcuts.length || $slots.shortcuts">
      <slot name="shortcuts">
        <div :class="[panelPrefix + '-shortcut']"
          v-for="shortcut in shortcuts" :key="shortcut.text"
          @click="handleShortcutClick(shortcut)">
          {{ shortcut.text }}
          <div
            v-if="shortcut.shortcutsPanel && shortcut.shortcutsPanel.length"
            :class="[panelPrefix + '-shortcutpanel']">
          </div>
        </div>
      </slot>
    </div>
    <div :class="[panelPrefix + '-sidebar']" v-if="holidays || $slots.holidays">
      <slot name="holidays">
        <div
          v-for="holidayCut in holidayCuts" :key="holidayCut.text"
          :class="[panelPrefix + '-holidayCuts',
          disabledHoliday(holidayCut) ? 'disabled-holidayCuts' : '',
          activeHoliday === holidayCut ? 'active-holidayCuts' : '']"
          @click="handleholidayCutClick(holidayCut, disabledHoliday(holidayCut))">
          {{ holidayCut }}
          <div
            v-if="holidayCut.holidayCutsPanel && holidayCut.holidayCutsPanel.length"
            :class="[panelPrefix + '-holidayCutpanel']">
          </div>
        </div>
      </slot>
    </div>
    <div :class="[panelPrefix + '-sidebar']" v-if="(!((holidays || $slots.holidays) || (shortcuts.length || $slots.shortcuts)) && pickerType === 'holidayrange')">
      <div :class="[panelPrefix + '-holidayCuts',
          disabledHoliday(holidayCut) ? 'disabled-holidayCuts' : '',
        activeHoliday === holidayCut ? 'active-holidayCuts' : '']"
        v-for="holidayCut in holidayCuts" :key="holidayCut"
        @click="handleholidayCutClick(holidayCut, disabledHoliday(holidayCut))">
        {{ holidayCut }}
        <div
          v-if="holidayCut.holidayCutsPanel && holidayCut.holidayCutsPanel.length"
          :class="[panelPrefix + '-holidayCutpanel']">
        </div>
      </div>
    </div>
    <div :class="panelBodyClasses">
      <div :class="[panelPrefix + '-content', panelPrefix + '-content-left']">
        <div :class="`${prefix}-time-header`" v-if="showTime">
          <picker-input
            :current-value="leftInput"
            size="small"
            readonly
          />
          <time-picker
            ref="timePicker"
            v-bind="timePickerOptions"
            size="small"
            :value="leftTime"
            :time-place="timePlace"
            :open.sync="openLeftTime"
            placement="bottom-end"
            :disabled="timeDisabled"
            @input="handleLeftTimeChange"
            :append-to-container="false"
          />
        </div>
        <div :class="[prefix + '-header']">
          <span :class="iconBtnCls('prev', '-double')"
            @click="prevYear('left')"
            v-if="validHolidayBackward">
            <Icon name="fast-backward" />
          </span>
          <span v-if="leftPickerTable === 'date-table' && validHolidayPrev"
            :class="iconBtnCls('prev')"
            @click="prevMonth('left')"
            v-show="currentView === 'date'">
            <Icon name="left" />
          </span>
          <date-panel-label
            :date-panel-label="leftDatePanelLabel"
            :current-view="leftDatePanelView"
            :date-prefix-cls="prefix" />
          <span
            v-if="validHolidayForward && (splitPanels || currentView !== leftPickerTable.split('-')[0])"
            :class="iconBtnCls('next', '-double')"
            @click="nextYear('left')">
            <Icon name="fast-forward" />
          </span>
          <span
            v-if="splitPanels && leftPickerTable === 'date-table' && validHolidayNext"
            :class="iconBtnCls('next')"
            @click="nextMonth('left')"
            v-show="currentView === 'date'">
            <Icon name="right" />
          </span>
        </div>
        <component
          :is="leftPickerTable"
          ref="leftYearTable"
          :table-date="leftPanelDate"
          selection-mode="range"
          :disabled-date="disabledDate"
          :range-state="rangeState"
          :holidays="holidaysData"
          :show-week-numbers="isWeek || showWeekNumbers"
          :work-cell-icon="workCellIcon"
          :is-week="isWeek"
          :iso-week="isoWeek"
          :value="preSelecting.left ? [dates[0]] : dates"
          :focused-date="focusedDate"
          :picker-type="pickerType"
          :week-start="weekStart"
          :week-year-first-start="weekYearFirstStart"
          @change-range="handleChangeRange"
          @pick="panelPickerHandlers.left"
        >
          <template slot-scope="scope" slot="cell">
            <slot :cell="scope.cell" name="cell" />
          </template>
          <template slot-scope="scope" slot="weekCell">
            <slot :cell="scope.cell" name="weekCell" />
          </template>
        </component>
      </div>
      <div :class="[panelPrefix + '-content', panelPrefix + '-content-right']" v-if="!(this.pickerType === 'holiday' || this.pickerType === 'holidayrange')">
        <div :class="`${prefix}-time-header`" v-if="showTime">
          <picker-input
            :current-value="rightInput"
            size="small"
            readonly
          />
          <time-picker
            ref="timePicker"
            v-bind="timePickerOptions"
            size="small"
            :value="rightTime"
            :time-place="timePlace"
            :open.sync="openRightTime"
            placement="bottom-end"
            :disabled="timeDisabled"
            @input="handleRightTimeChange"
           :append-to-container="false"
          />
        </div>
        <div :class="[prefix + '-header']">
            <span :class="iconBtnCls('prev', '-double')"
              @click="prevYear('right')"
              v-if="validHolidayBackward">
              <Icon name="fast-backward" />
            </span>
            <span v-if="rightPickerTable === 'date-table' && validHolidayPrev"
              :class="iconBtnCls('prev')"
              @click="prevMonth('right')"
              v-show="currentView === 'date'">
              <Icon name="left" />
            </span>
            <date-panel-label
              :date-panel-label="rightDatePanelLabel"
              :current-view="rightDatePanelView"
              :date-prefix-cls="prefix" />
            <span
              v-if="validHolidayForward && (splitPanels || currentView !== rightPickerTable.split('-')[0])"
              :class="iconBtnCls('next', '-double')"
              @click="nextYear('right')">
              <Icon name="fast-forward" />
            </span>
            <span
              v-if="splitPanels && rightPickerTable === 'date-table' && validHolidayNext"
              :class="iconBtnCls('next')"
              @click="nextMonth('right')"
              v-show="currentView === 'date'">
              <Icon name="right" />
            </span>
        </div>
        <component
          :is="rightPickerTable"
          ref="rightYearTable"
          :table-date="rightPanelDate"
          selection-mode="range"
          :disabled-date="disabledDate"
          :range-state="rangeState"
          :holidays="holidaysData"
          :show-week-numbers="isWeek || showWeekNumbers"
          :work-cell-icon="workCellIcon"
          :iso-week="isoWeek"
          :is-week="isWeek"
          :value="preSelecting.right ? [dates[dates.length - 1]] : dates"
          :focused-date="focusedDate"
          :picker-type="pickerType"
          :week-start="weekStart"
          :week-year-first-start="weekYearFirstStart"
          @change-range="handleChangeRange"
          @pick="panelPickerHandlers.right">
          <template slot-scope="scope" slot="cell">
            <slot :cell="scope.cell" name="cell" />
          </template>
          <template slot-scope="scope" slot="weekCell">
            <slot :cell="scope.cell" name="weekCell" />
          </template>
        </component>
      </div>
      <Confirm
        v-if="confirm"
        :show-time="showTime"
        :show-btn-now="showBtnNow"
        :time-disabled="timeDisabled"
        @toggle="handleToggleTime"
        @click-now="handlePickClickNow"
        @confirm="handlePickSuccess">
        <template slot v-if="$slots.confirm">
          <slot name="confirm" />
        </template>
      </Confirm>
    </div>
  </div>
</template>
<script>
import DateTable from '../../base/date-table.vue';
import HolidayTable from '../../base/holiday-table.vue';
import YearTable from '../../base/year-table.vue';
import HalfyearTable from '../../base/halfyear-table.vue';
import MonthTable from '../../base/month-table.vue';
import QuarterTable from '../../base/quarter-table.vue';
import TimePicker from '@components/time-picker';
import Confirm from '../../base/confirm.vue';
import PickerInput from '../../input.js';
import Icon from '@components/icon';
import dayjs from 'dayjs';
import {
  NORMAL_HOLIDAY
} from '../../../../utils/specialDayRange';
import {
  DEFAULT_FORMATS,
  TYPE_VALUE_RESOLVER_MAP,
  toDate,
  initTimeDate,
  formatDateLabels,
  getDatesInRange
} from '../../../../utils/date';
import datePanelLabel from './date-panel-label.vue';

import Mixin from '../panel-mixin';
import DateMixin from './date-panel-mixin';
import Locale from '../../../../mixins/locale';

const dateSorter = (a, b) => {
  if (!a || !b) return 0;
  return a.getTime() - b.getTime();
};

export default {
  name: 'RangeDatePickerPanel',
  components: {
    DateTable,
    HolidayTable,
    YearTable,
    HalfyearTable,
    MonthTable,
    QuarterTable,
    TimePicker,
    Confirm,
    datePanelLabel,
    PickerInput,
    Icon,
  },
  mixins: [ Mixin, Locale, DateMixin ],
  inheritAttrs: false,
  props: {
    // more props in the mixin
    splitPanels: {
      type: Boolean,
      default: false,
    },
    defaultTime: {
      type: Array,
      default() {
        return [];
      },
    },
  },
  data() {
    const [minDate, maxDate] = this.value.map(date => date || initTimeDate());
    const leftPanelDate = this.startDate ? this.startDate : minDate;

    return {
      dates: [...this.value],
      rangeState: {
        from: this.value[0],
        to: this.value[1],
        selecting: minDate && !maxDate,
      },
      currentView: this.selectionMode || 'range',
      leftPickerTable: `${this.selectionMode}-table`,
      rightPickerTable: `${this.selectionMode}-table`,
      leftPanelDate,
      activeHoliday: '',
      rightPanelDate: new Date(
        leftPanelDate.getFullYear(),
        leftPanelDate.getMonth() + 1,
        1,
      ),
      openLeftTime: false,
      openRightTime: false,
    };
  },
  computed: {
    validHolidayPrev() {
      if (this.pickerType === 'holiday' || this.pickerType === 'holidayrange') {
        if (this.leftPanelDate.getFullYear() < this.firstYear + 1 && this.leftPanelDate.getMonth() < 1) {
          return false;
        }
      }
      return true;
    },
    validHolidayBackward() {
      if (this.pickerType === 'holiday' || this.pickerType === 'holidayrange') {
        if (this.leftPanelDate.getFullYear() < this.firstYear + 1) {
          return false;
        }
      }
      return true;
    },
    validHolidayForward() {
      if (this.pickerType === 'holiday' || this.pickerType === 'holidayrange') {
        if (this.leftPanelDate.getFullYear() > this.lastYear - 1) {
          return false;
        }
      }
      return true;
    },
    validHolidayNext() {
      if (this.pickerType === 'holiday' || this.pickerType === 'holidayrange') {
        if (this.leftPanelDate.getFullYear() > this.lastYear - 1 && this.leftPanelDate.getMonth() >= 11) {
          return false;
        }
      }
      return true;
    },
    isWeek() {
      return this.pickerType === 'weekrange';
    },
    classes() {
      const { prefix, panelPrefix } = this;
      return [
        `${panelPrefix}-body-wrapper`,
        `${prefix}-with-range`,
        `mpa-picker-panel-body-wrapper`,
        {
          [`${panelPrefix}-with-sidebar`]: this.shortcuts.length,
          [`${prefix}-with-week-numbers`]: this.showWeekNumbers,
        },
      ];
    },
    panelBodyClasses() {
      const { panelPrefix } = this;
      return [
        panelPrefix + '-body',
        {
          [panelPrefix + '-body-time']: this.showTime,
          [panelPrefix + '-body-date']: !this.showTime,
        },
      ];
    },
    leftDatePanelLabel() {
      return this.panelLabelConfig('left');
    },
    rightDatePanelLabel() {
      return this.panelLabelConfig('right');
    },
    leftDatePanelView() {
      return this.leftPickerTable.split('-').shift();
    },
    rightDatePanelView() {
      return this.rightPickerTable.split('-').shift();
    },
    timeDisabled() {
      return !(this.dates[0] && this.dates[1]);
    },
    preSelecting() {
      const tableType = `${this.currentView}-table`;

      return {
        left: this.leftPickerTable !== tableType,
        right: this.rightPickerTable !== tableType,
      };
    },
    panelPickerHandlers() {
      return {
        left: this.preSelecting.left
          ? this.handlePreSelection.bind(this, 'left')
          : this.handleRangePick,
        right: this.preSelecting.right
          ? this.handlePreSelection.bind(this, 'right')
          : this.handleRangePick,
      };
    },
    leftTime() {
      return this.value[0] || '';
    },
    leftInput() {
      return this.leftTime ? this.formatDateToInput(this.leftTime, 'date')
        : '';
    },
    rightTime() {
      return this.value[1] || '';
    },
    rightInput() {
      return this.rightTime ? this.formatDateToInput(this.rightTime, 'date')
        : '';
    },
    holidayCuts() {
      if (this.pickerType === 'holidayrange') {
        if (this.holidaysData && this.holidaysData.details) {
          const arr = [];
          const labelYear = parseInt(this.leftDatePanelLabel.labels[0].label.match(/\d+/)[0]);
          if (this.holidaysData.details[labelYear]) {
            for (const j of Object.keys(this.holidaysData.details[labelYear])) {
              if (this.holidaysData.details[labelYear][j].isHoliday && !arr.includes(j)) {
                arr.push(j);
              }
            }
          }
          return arr;
        }
      }
      return NORMAL_HOLIDAY;
    }
  },
  watch: {
    value(newVal) {
      this.handleValueChange(newVal);
      this.checkActiveHoliday(newVal);
    },
    currentView(currentView) {
      const leftMonth = this.leftPanelDate.getMonth();
      const rightMonth = this.rightPanelDate.getMonth();
      const isSameYear = this.leftPanelDate.getFullYear() ===
        this.rightPanelDate.getFullYear();
      if (currentView === 'date' && isSameYear && leftMonth === rightMonth) {
        this.changePanelDate('right', 'M', 1);
      }
      if (currentView === 'quarter' && isSameYear) {
        this.changePanelDate('right', 'Q', 1);
      }
      if (currentView === 'month' && isSameYear) {
        this.changePanelDate('right', 'y', 1);
      }
      if (currentView === 'halfyear' && isSameYear) {
        this.changePanelDate('right', 'y', 10);
      }
      if (currentView === 'year' && isSameYear) {
        this.changePanelDate('right', 'y', 10);
      }
    },
    selectionMode(type) {
      this.currentView = type || 'range';
    },
    focusedDate(date) {
      this.setPanelDates(date || new Date());
    },
    visible(v) {
      if (!v) {
        this.handleValueChange(this.value);
      }
    },
  },
  created() {
    // 根据当前值设置左右面板
    this.setPanelDates(this.leftPanelDate);
    this.checkActiveHoliday(this.value);
    this.rangeState = {
      from: this.dates[0],
      to: this.dates[1],
      selecting: false,
    };
  },
  methods: {
    checkActiveHoliday(value) {
      this.activeHoliday = '';
      if (value[0] && value[1] && value[1].getFullYear()) {
        const currentYear = this.holidaysData.details[value[1].getFullYear()] || {};
        for (const i of Object.keys(currentYear)) {
          const range = this.holidaysData['range'][i] && this.holidaysData['range'][i][0] || 0;
          const range2 = this.holidaysData['range'][i] && this.holidaysData['range'][i][1] || 0;
          if (
          getDatesInRange(
            dayjs(currentYear[i].dates[0]).add(range, 'd'),
            dayjs(currentYear[i].dates[1]).add(range2, 'd')).includes(dayjs(value[0]).format('YYYY-MM-DD')) &&
          getDatesInRange(
            dayjs(currentYear[i].dates[0]).add(range, 'd'),
            dayjs(currentYear[i].dates[1]).add(range2, 'd')).includes(dayjs(value[1]).format('YYYY-MM-DD'))) {
            this.activeHoliday = i;
          }
        }
      }
    },
    disabledHoliday(shortcut) {
      const that = this;
      const labelYear = parseInt(this.leftDatePanelLabel.labels[0].label.match(/\d+/)[0]);
      const currentYear = this.holidaysData['details'][labelYear] || {};
      let holidayList = [];
      let d1;
      let d2;
      if (currentYear[shortcut]) {
        d1 = new Date(currentYear[shortcut].dates[0]);
        d2 = new Date(currentYear[shortcut].dates[1]);
        holidayList = getDatesInRange(dayjs(d1), dayjs(d2));
      }
      if (holidayList.every((day) => {
        return that.disabledDate(new Date(day));
      })) {
        return true;
      } else {
        return false;
      }
    },
    handleValueChange(newVal) {
      const minDate = newVal[0] ? toDate(newVal[0]) : null;
      const maxDate = newVal[1] ? toDate(newVal[1]) : null;
      this.dates = [minDate, maxDate].sort(dateSorter);
      this.rangeState = {
        from: this.dates[0],
        to: this.dates[1],
        selecting: false,
      };

      // set panels positioning
      this.setPanelDates(this.startDate || this.dates[0] || new Date());
    },
    reset() {
      this.currentView = this.selectionMode;
      this.leftPickerTable = `${this.currentView}-table`;
      this.rightPickerTable = `${this.currentView}-table`;
    },
    setPanelDates(leftPanelDate) {
      this.leftPanelDate = leftPanelDate;
      let rightPanelDate;
      if (this.currentView === 'month' || this.currentView === 'quarter' || this.currentView === 'halfyear') {
        rightPanelDate = new Date(
          leftPanelDate.getFullYear() + 1,
          leftPanelDate.getMonth(),
          1,
        );
      } else if (this.currentView === 'year') {
        rightPanelDate = new Date(
          leftPanelDate.getFullYear() + 10,
          leftPanelDate.getMonth(),
          1,
        );
      } else {
        rightPanelDate = new Date(
          leftPanelDate.getFullYear(),
          leftPanelDate.getMonth() + 1,
          1,
        );
      }
      this.rightPanelDate = this.splitPanels
        ? new Date(Math.max(this.dates[1] || rightPanelDate, rightPanelDate))
        : rightPanelDate;
    },
    panelLabelConfig(direction) {
      const handler = type => {
        let fn;
        switch (type) {
          case 'month':
            fn = this.showMonthPicker;
            break;
          case 'halfyear':
            fn = this.showHalfYearPicker;
            break;
          case 'year':
            fn = this.showYearPicker;
            break;
          case 'quarter':
            fn = this.showQuarterPicker;
            break;
        }
        return () => fn(direction);
      };

      const date = this[`${direction}PanelDate`];
      const {
        labels,
        separator,
      } = formatDateLabels(this.t, date);
      return {
        separator,
        labels: labels.map(obj => {
          obj.handler = handler(obj.type);
          return obj;
        }),
      };
    },
    prevYear(panel) {
      const increment = this.currentView === 'year' ? -10 : -1;
      this.changePanelDate(panel, 'y', increment);
    },
    nextYear(panel) {
      const increment = this.currentView === 'year' ? 10 : 1;
      this.changePanelDate(panel, 'y', increment);
    },
    prevMonth(panel) {
      this.changePanelDate(panel, 'M', -1);
    },
    nextMonth(panel) {
      this.changePanelDate(panel, 'M', 1);
    },
    changePanelDate(panel, type, increment, updateOtherPanel = true) {
      let current = new Date(this[`${panel}PanelDate`]);
      current = dayjs(current).add(increment, type).toDate();
      this[`${panel}PanelDate`] = current;

      if (!updateOtherPanel) return;

      if (this.splitPanels) {
        // change other panel if dates overlap
        const otherPanel = panel === 'left' ? 'right' : 'left';
        if (panel === 'left' && this.leftPanelDate >= this.rightPanelDate) {
          this.changePanelDate(otherPanel, type, 1);
        }
        if (panel === 'right' && this.rightPanelDate <= this.leftPanelDate) {
          this.changePanelDate(otherPanel, type, -1);
        }
      } else {
        // keep the panels together
        const otherPanel = panel === 'left' ? 'right' : 'left';
        const otherCurrent = new Date(this[`${otherPanel}PanelDate`]);
        otherCurrent[`set${type}`](otherCurrent[`get${type}`]() + increment);
        this[`${otherPanel}PanelDate`] = otherCurrent;
      }
    },
    showYearPicker(panel) {
      this[`${panel}PickerTable`] = 'year-table';
    },
    showHalfYearPicker(panel) {
      this[`${panel}PickerTable`] = 'halfyear-table';
    },
    showQuarterPicker(panel) {
      this[`${panel}PickerTable`] = 'quarter-table';
    },
    showMonthPicker(panel) {
      this[`${panel}PickerTable`] = 'month-table';
    },
    handlePreSelection(panel, value) {
      this[`${panel}PanelDate`] = value;
      const currentViewType = this[`${panel}PickerTable`];
      if (currentViewType === 'year-table') {
        if  (this.currentView === 'quarter' || this.currentView === 'halfyear') {
          this[`${panel}PickerTable`] = `${this.currentView}-table`;
        } else {
          this[`${panel}PickerTable`] = 'month-table';
        }
      } else {
        this[`${panel}PickerTable`] = `${this.currentView}-table`;
      }

      if (!this.splitPanels) {
        const otherPanel = panel === 'left' ? 'right' : 'left';
        this[`${otherPanel}PanelDate`] = value;
        this.changePanelDate(otherPanel, 'M', 1, false);
      }
    },

    setDefaultTime(date, oldDate, defaultTime) {
      const time = (defaultTime || '0:0:0').split(':');
      const hours = oldDate ? oldDate.getHours() : time[0];
      const mins = oldDate ? oldDate.getMinutes() : time[1];
      const sec = oldDate ? oldDate.getSeconds() : time[2];
      date.setHours(hours, mins, sec);
      return date;
    },

    handleRangePick(val, type) {
      if (this.rangeState.selecting || this.currentView === 'time') {
        if (this.currentView === 'time') {
          this.dates = val;
        } else {
          switch (this.pickerType) {
            case 'yearrange':
              val = dayjs(val).endOf('y').toDate();
              break;
            case 'halfyearrange':
              const half = dayjs(val).month() > 5 ? 11 : 5;
              val = dayjs(val).month(half).endOf('M').toDate();
              break;
            case 'quarterrange':
              val = dayjs(val).endOf('Q').toDate();
              break;
            case 'monthrange':
              val = dayjs(val).endOf('M').toDate();
              break;
            case 'weekrange':
              val = dayjs(val).endOf('w').toDate();
              break;
          }
          const [
            minDate,
            maxDate,
          ] = [this.rangeState.from, val].sort(dateSorter);
          const dates = [minDate, maxDate].map((date, i) => {
            return this.setDefaultTime(date, this.value[i], this.defaultTime[i]);
          });

          this.dates = dates;
          this.rangeState = {
            from: minDate,
            to: maxDate,
            selecting: false,
          };
        }
        this.handleConfirm(false, type || 'date');
      } else {
        this.rangeState = {
          from: val,
          to: null,
          selecting: true,
        };
      }
      this.$emit('pick-range', this.rangeState);
    },
    handleChangeRange(val) {
      if (!this.rangeState.selecting) {
        if (this.isWeek) {
          this.rangeState.from = val;
          this.rangeState.to = val;
        }
        return;
      }
      this.rangeState.to = val;
    },

    handleLeftTimeChange(time) {
      const left = this.dates[0];
      const hours = time ? time.getHours() : 0;
      const mins = time ? time.getMinutes() : 0;
      const sec = time ? time.getSeconds() : 0;
      const d = new Date(left);

      d.setHours(hours, mins, sec);

      this.dates[0] = d;
      // 保证 left time 一定小于 right time。
      // to fix ones(https://ones.sankuai.com/ones/product/4348/workItem/defect/detail/3167759)
      if (this.dates[0].getTime() > this.dates[1].getTime()) {
        this.dates[1].setHours(hours, mins, sec);
      }
      this.handleConfirm(false);
    },

    handleRightTimeChange(time) {
      const right = this.dates[1];

      const hours = time ? time.getHours() : 0;
      const mins = time ? time.getMinutes() : 0;
      const sec = time ? time.getSeconds() : 0;
      const d = new Date(right);

      d.setHours(hours, mins, sec);

      this.dates[1] = d;
      this.handleConfirm(false);
    },

    formatDateToInput(value, type) {
      let format = this.format;
      if (format) {
        format = format.split(' ')[0];
      }
      format = format || DEFAULT_FORMATS[type];
      const { formatter } = (
        TYPE_VALUE_RESOLVER_MAP[type] ||
        TYPE_VALUE_RESOLVER_MAP['default']
      );
      return formatter(value, format);
    },
  },
};
</script>
