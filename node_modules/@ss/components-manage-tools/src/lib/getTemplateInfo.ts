import { fatalLog } from '../util/log';
import { checkLogin } from './login';
import { envHost, getSignature } from '../util/constant';

const fetch = require('node-fetch');

export const getTemplateListAndCodeUrl = async (templateLibId: any) => {
    checkLogin();
    const _octo = await getSignature();
    try {
        const value = await fetch(`${envHost}/openapi/v1/template/templateLibInfo?templateLibId=${templateLibId}`, {
            method: 'GET',
            headers: {
                "Content-Type": 'application/json',
                "oceanus-auth": _octo
            },
        });
        const res = await value.json();
        if (res.code !== 0) {
            fatalLog(res.message);
        } else {
            return res.data || [];
        }
    } catch (e: any) {
        fatalLog(`register component failed: ${e}.`)
    }
}

export const getTemplateCodeUrl = async (templateId: any) => {
    checkLogin();
    const _octo = await getSignature();
    try {
        const value = await fetch(`${envHost}/openapi/v1/template/templateInfo?templateId=${templateId}`, {
            method: 'GET',
            headers: {
                "Content-Type": 'application/json',
                "oceanus-auth": _octo
            },
        });
        const res = await value.json();
        if (res.code !== 0) {
            fatalLog(res.message);
        } else {
            return res.data || {};
        }
    } catch (e: any) {
        fatalLog(`register component failed: ${e}.`)
    }
}