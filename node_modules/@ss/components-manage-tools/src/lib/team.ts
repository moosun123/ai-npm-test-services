import { fatalLog } from '../util/log';
import { checkLogin } from './login';
import { envHost, getSignature } from '../util/constant';

const fetch = require('node-fetch');

export const addTeamMembers = async (addParams: any) => {
    checkLogin();
    const _octo = await getSignature();
    try {
        const value = await fetch(`${envHost}/openapi/v1/team/addMember`, {
            method: 'POST',
            body: JSON.stringify(addParams),
            headers: {
                "Content-Type": 'application/json',
                "oceanus-auth": _octo
            },
        });
        const res = await value.json();
        if (res.code !== 0) {
            fatalLog(res.message);
        } else {
            return res || {};
        }
    } catch (e: any) {
        fatalLog(`add team members failed: ${e}.`)
    }
}

export const createTeam = async (createParams: any) => {
    checkLogin();
    const _octo = await getSignature();
    try {
        const value = await fetch(`${envHost}/openapi/v1/team/create`, {
            method: 'POST',
            body: JSON.stringify(createParams),
            headers: {
                "Content-Type": 'application/json',
                "oceanus-auth": _octo
            },
        });
        const res = await value.json();
        if (res.code !== 0) {
            fatalLog(res.message);
        } else {
            return res.data || {};
        }
    } catch (e: any) {
        fatalLog(`create team failed: ${e}.`)
    }
}