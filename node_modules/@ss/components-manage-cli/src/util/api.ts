import * as fs from 'fs';
import * as path from 'path';

export function getAPIInfo(cwd: string, components: any) {
    const api: { [key: string]: any } = {};
    const componentsJson = path.join(cwd, 'components.json');
    const componentsStr = JSON.parse(fs.readFileSync(componentsJson).toString());
    Object.entries(components).forEach(([component]) => {
        const componentPath = componentsStr[component];
        const apiJSONPath = path.join(cwd, `./${componentPath}/doc/api.json`);
        if (fs.existsSync(apiJSONPath)) {
            try {
                api[component] = JSON.parse(fs.readFileSync(apiJSONPath).toString());
            } catch (e) {}
        }
    });
    return api;
}

export function getCodeInfo(cwd: string, components: any) {
    const code: { [key: string]: any } = {};
    const componentsJson = path.join(cwd, 'components.json');
    const componentsStr = JSON.parse(fs.readFileSync(componentsJson).toString());
    Object.entries(components).forEach(([component]) => {
        const componentPath = componentsStr[component];
        const codeFilePath = path.join(cwd, `./${componentPath}/doc/code.txt`);
        if (fs.existsSync(codeFilePath)) {
            try {
                code[component] = fs.readFileSync(codeFilePath).toString();
            } catch (e) {}
        }
    });
    return code;
}
