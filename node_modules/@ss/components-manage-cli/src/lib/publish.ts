import * as path from 'path';
import { publishComponentLib } from './publishComponentLib';
import { publishTemplateLib } from './publishTemplateLib';
import { publishLowcode } from './lowcode';
import { publishDocs } from './docs';
import { fatalLog } from '@ss/components-manage-tools';

export const publish = async (options: any) => {
    console.log('publish options======>', options)
    if (options.publishLowcode) {
        publishLowcode(options);
    } else if (options.publishDocs) {
        publishDocs(options);
    } else {
        const libInfo = require(path.join(process.cwd(), 'template.json'));
        const { materialType } = libInfo;
        if (materialType === 'component') {
            publishComponentLib(options);
        } else if (materialType === 'template') {
            if (options.publishTplTechStack === 'vue') {
                options.templatePath = 'views';
                options.entryName = 'main.ts';
            } else if (options.publishTplTechStack === 'react') {
                options.templatePath = 'pages';
                options.entryName = 'index.js';
            } else {
                fatalLog('缺少发布的模板库技术栈配置项，cm cli使用文档请参考 https://km.sankuai.com/collabpage/1348115416。');
            }
            publishTemplateLib(options);
        } else {
            fatalLog('template.json文件中缺失materialType配置项，请添加（组件库值为component，模板库值为template）。');
        }
    }
};