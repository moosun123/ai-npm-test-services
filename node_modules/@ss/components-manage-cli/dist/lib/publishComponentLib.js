"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.publishComponentLib = void 0;
const path_1 = require("path");
const common_1 = require("../util/common");
const report_1 = require("../util/report");
const release_1 = require("../util/release");
const components_manage_tools_1 = require("@ss/components-manage-tools");
const fs = require('fs');
async function publishComponentLib(options) {
    if (options.skipCheck) {
        options.skipCheckBranch = true;
        options.skipTest = true;
    }
    const dir = process.cwd();
    (0, common_1.checkDocAPI)(dir);
    const config = require((0, path_1.join)(dir, 'template.json'));
    if (config.framework === 'vue') {
        (0, report_1.injectReportLogic)();
    }
    const data = await (0, release_1.extractReleaseInfo)(options);
    data.techStackVersion = (0, common_1.getFrameworkVersion)(config.framework);
    data.materialVersion = (0, common_1.getMaterialVersion)();
    data.isFollowLowcode = fs.existsSync((0, path_1.join)(process.cwd(), 'lowcode'));
    data.noPublishLowcode = options.publishNoLowcode ? true : false;
    await (0, components_manage_tools_1.publishApi)(data, 'component', true);
}
exports.publishComponentLib = publishComponentLib;
