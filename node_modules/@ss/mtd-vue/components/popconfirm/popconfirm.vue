<template>
<popover :popper-class="prefix"
  v-bind="$attrs" v-on="$listeners" ref="popover">
  <slot />
  <template slot="content">
    <div :class="`${prefix}-inner`">
      <span v-if="sIcon" :class="`${prefix}-icon`"><i :class="sIcon" /></span>
      <div :class="`${prefix}-content`">
        <div :class="`${pp}-title`" v-if="$slots.title || title">
          <slot name="title">{{ title }}</slot>
        </div>
        <div :class="`${prefix}-message`" v-if="$slots.message || message">
          <slot name="message">
            {{ message }}
          </slot>
        </div>
      </div>
    </div>
    <div :class="`${prefix}-actions`">
      <Button v-bind="cancelProps" @click="cancel">{{ cancelButtonText }}</Button>
      <Button v-bind="okProps" @click="ok">{{ okButtonText }}</Button>
    </div>
  </template>
</popover>
</template>
<script>
import MtdPopover from '@components/popover';
import Button from '@components/button';
import { hasProps } from '@/utils/vnode';
import {
  CONFIG_PROVIDER,
  getPrefixCls,
  getIconCls,
} from '@/utils/config';
const Popover = MtdPopover.WrappedComponent;

export default {
  name: 'Popconfirm',
  components: {
    Popover,
    Button,
  },
  inheritAttrs: false,
  props: {
    title: String,
    message: String,
    icon: String,
    okButtonText: {
      type: String,
      default: '确定',
    },
    cancelButtonText: {
      type: String,
      default: '取消',
    },
    okButtonProps: Object,
    cancelButtonProps: Object,
  },
  inject: {
    config: {
      from: CONFIG_PROVIDER,
      default: {
        getPrefixCls,
        getIconCls,
      },
    },
  },
  computed: {
    prefix () {
      return this.config.getPrefixCls('popconfirm');
    },
    pp () {
      return this.config.getPrefixCls('popover');
    },
    sIcon () {
      return hasProps(this, 'icon') ? this.icon : this.config.getIconCls('warning-circle');
    },
    okProps () {
      return {
        type: 'danger',
        size: 'small',
        ...this.okButtonProps,
      };
    },
    cancelProps () {
      return {
        size: 'small',
        ...this.cancelButtonProps,
      };
    },
  },
  methods: {
    ok () {
      this.$emit('ok');
      this.$emit('input', false);
    },
    cancel () {
      this.$emit('cancel');
      this.$emit('input', false);
    },
    updatePopper () {
      this.$refs.popover.updatePopper();
    },
  },
};
</script>
