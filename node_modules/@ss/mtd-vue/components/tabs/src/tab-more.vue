<script>
import MtdSelect from '@components/select';
import MtdOption from '@components/option';
import MtdPicker from '@components/picker';

export default {
  name: 'MtdTabMore',

  components: {
    MtdSelect,
    MtdOption,
    MtdPicker,
  },

  props: {
    label: String,
    size: String,
    disabled: Boolean,
    moreTabs: Array,
    currentValue: [String, Number, Object, Array],
    dropAutosize: Boolean,
    prefix: {
      type: String,
      required: true,
    },
    tabComponent: [String, Object],
  },

  data () {
    return {
      selectValue: this.label,
    };
  },

  watch: {
    currentValue: {
      immediate: true,
      handler () {
        this.setSelectValue();
      },
    },
    moreTabs () {
      this.setSelectValue();
    },
  },
  methods: {
    setSelectValue () {
      const selected = this.moreTabs.find((item) => {
        return item.value === this.currentValue;
      });
      if (!selected) {
        this.selectValue = this.label;
      } else {
        this.selectValue = selected.label;
      }
    },
  },
  render (h) {
    const {
      selectValue,
      moreTabs,
      disabled,
      size,
      dropAutosize,
      prefix,
    } = this;
    const props = {
      popperClass: `${prefix}-select`,
      value: selectValue,
      placeholder: '',
      disabled,
      size,
      genre: 'line',
    };
    const MtdSelectData = {
      props: props,
      attrs: props,
      on: {
        input: (value) => {
          // 手动更新select value
          this.$nextTick(() => {
            if (value) {
              this.selectValue = value;
              this.$emit('tabSelectClick', value);
            }
          });
        },
      },
    };
    const Component = dropAutosize ? MtdPicker : MtdSelect;
    return (
      <Component
        {...MtdSelectData}
        class={ dropAutosize ? '' : `${prefix}-select-item` }
      >
        {
          moreTabs && moreTabs.map(item => {
            return (
              <mtd-option
                key={item.value}
                value={ item.value }
                label={ item.label }
                class={ item.labelClass }
                disabled={ item.disabled }
              >
                {item.$slots && item.$slots.label && <template slot="default">
                  {item.$slots.label}
                </template> }
              </mtd-option>
            );
          },
          )
        }
      </Component>
    );
  },
};
</script>
