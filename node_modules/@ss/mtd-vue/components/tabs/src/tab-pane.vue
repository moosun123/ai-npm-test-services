<script>
import {
  CONFIG_PROVIDER,
  getPrefixCls,
} from '@/utils/config';

export default {
  name: 'MtdTabPane',

  props: {
    label: String,
    value: {
      type: [String, Number, Object, Array],
      required: true,
    },
    icon: String,
    closable: Boolean,
    disabled: Boolean,
    labelClass: String,
    lazy: Boolean,
    destroyOnHide: {
      type: Boolean,
      default: false,
    },
  },
  inject: {
    config: {
      from: CONFIG_PROVIDER,
      default: {
        getPrefixCls,
      },
    },
  },
  data () {
    return {
      id: Math.random(),
      index: 0,
      active: false,
      hasContent: false,
      $tab: undefined, // will set value in tab-one component.
      mounted: !this.lazy && !this.destroyOnHide,
    };
  },

  computed: {
    prefix () {
      return this.config.getPrefixCls('tab-pane');
    },
    isClosable () {
      return this.closable || this.$parent.closable;
    },

    paneName () {
      return this.value || this.index;
    },

    dropActive () {
      return this.value === this.$parent.currentValue;
    },

    act () {
      return this.active || this.dropActive;
    },
  },

  watch: {
    label () {
      this.$parent.$forceUpdate();
    },
    act (v) {
      if (this.destroyOnHide) {
        this.mounted = v;
      } else if (v) {
        this.mounted = v;
      }
    },
  },

  mounted () {
    this.$parent.addTabs && this.$parent.addTabs(this, this.$parent);
  },

  updated () {
    this.$parent.$emit('tab-nav-update');
  },

  render (h) {
    const {
      act,
      mounted,
    } = this;
    this.hasContent = this.$slots.default && this.$slots.default.length;
    return (
      <div
        class={{
          [this.prefix]: true,
        }}
        v-show={act}
        ref='pane'
      >
        {(act || mounted) && this.$slots.default}
      </div>
    );
  },
};
</script>
