<template>
  <transition :name="`${prefix}-fade`">
    <div
      :class="typeClass"
      v-show="visible">
      <i :class="[ iconClass, `${prefix}-icon` ]" v-if="showIcon" />
      <div :class="`${prefix}-content`">
        <div :class="{
          [`${prefix}-title`]: true,
          [`${prefix}-title-large`]: description || this.$slots.description
        }">
          <slot>{{ title }}</slot>
        </div>
        <div :class="`${prefix}-description`"
          v-if="description || $slots.description">
          <slot name="description">{{ description }}</slot>
        </div>
        <a
          :class="`${prefix}-close`"
          v-show="canClosed"
          @click="close">
          <slot name="close"><Icon name="close-thick" /></slot>
        </a>
      </div>
    </div>
  </transition>
</template>

<script>
import Icon from '@components/icon';
import { CONFIG_PROVIDER,
  getPrefixCls,
  getIconCls,
} from '@/utils/config';

const TYPE_CLASSES_MAP = {
  'success': 'success-circle',
  'warning': 'warning-circle',
  'error': 'error-circle',
  'info': 'info-circle',
};
export default {
  name: 'MtdAnnouncement',
  components: {
    Icon,
  },
  props: {
    title: {
      type: String,
      default: '',
    },
    description: {
      type: String,
      default: '',
    },
    type: {
      type: String,
      default: 'warning',
    },
    closeable: Boolean, // 兼容历史
    closable: Boolean,

    showIcon: Boolean,
  },

  inject: {
    config: {
      from: CONFIG_PROVIDER,
      default: {
        getPrefixCls,
        getIconCls,
      },
    },
  },

  data () {
    return {
      visible: true,
    };
  },

  computed: {
    prefix () {
      return this.config.getPrefixCls('announcement');
    },
    iconPrefix () {
      return this.config.getIconCls;
    },
    TYPE_CLASSES_MAP () {
      return {
        'success': this.iconPrefix('success-circle'),
        'warning': this.iconPrefix('warning-circle'),
        'error': this.iconPrefix('error-circle'),
        'info': this.iconPrefix('info-circle'),
      };
    },
    canClosed () {
      return this.closable || this.closeable;
    },
    typeClass () {
      return {
        [this.prefix]: true,
        [`${this.prefix}-${this.type}`]: this.type,
        [`${this.prefix}-closable`]: this.closable,
        [`${this.prefix}-has-description`]:
          this.description || this.$slots.description,
      };
    },

    iconClass () {
      return this.iconPrefix(TYPE_CLASSES_MAP[this.type] || 'warning');
    },
  },

  methods: {
    close () {
      this.visible = false;
      this.$emit('close');
    },
  },
};
</script>
