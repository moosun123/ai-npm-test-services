<template>
  <span
    ref="switch"
    :class="wrapperCls"
    @click="handleClick">
    <input
      style="display: none;"
      :class="`${prefix}-input`"
      type="checkbox"
      ref="input"
      :checked="checked"
      :name="name">
    <span :class="btnCls">
      <slot name="loading" v-if="loading">
        <span :class="`${prefix}-spin`" />
      </slot>
    </span>
  </span>
</template>
<script>
import { hasProps } from '@/utils/vnode';
import { deprecated } from '@/utils/console';
import { CONFIG_PROVIDER,
  getPrefixCls,
  getSize,
} from '@/utils/config';

export default {
  name: 'MtdSwitch',
  model: {
    prop: 'value',
  },
  props: {
    // eslint-disable-next-line
    value: {},
    actived: {
      type: Boolean,
    },
    // eslint-disable-next-line
    trueValue: {
      default: true,
    },
    // eslint-disable-next-line
    falseValue: {
      default: false,
    },
    disabled: {
      type: Boolean,
    },
    size: {
      type: String,
    },
    loading: {
      type: Boolean,
    },
    name: {
      type: String,
    },
  },
  inject: {
    config: {
      from: CONFIG_PROVIDER,
      default: {
        getPrefixCls,
        getSize,
      },
    },
  },
  computed: {
    prefix () {
      return this.config.getPrefixCls('switch');
    },
    _size () {
      return this.config.getSize(this);
    },
    checked () {
      if (hasProps(this, 'actived')) {
        return this.actived;
      }
      return this.value === this.trueValue;
    },
    wrapperCls () {
      return [
        `${this.prefix}`,
        {
          [`${this.prefix}-active`]: this.checked,
          [`${this.prefix}-disabled`]: this.disabled,
          [`${this.prefix}-${this._size}`]: this._size,
          [`${this.prefix}-loading`]: this.loading,
        },
      ];
    },
    btnCls () {
      return [
        `${this.prefix}-btn`,
      ];
    },
  },
  mounted () {
    if (hasProps(this, 'actived')) {
      deprecated('Switch', 'actived', 'please use `value` replace `active`');
    }
  },
  methods: {
    handleClick (e) {
      e.preventDefault();
      if (this.disabled || this.loading) {
        return false;
      }
      const value = this.checked
        ? this.falseValue
        : this.trueValue;
      this.$emit('input', value);
      this.$emit('change', value);
    },
  },
};
</script>
