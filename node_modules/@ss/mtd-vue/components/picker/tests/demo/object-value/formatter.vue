<template>
  <mtd-picker v-model="value" :formatter="formatter"
    filterable value-key="id" ref="picker"
    :multiple="multiple"
  >
    <mtd-option v-for="item in options" :key="item.id" :value="item"
      :label="item.name"
    />
  </mtd-picker>
</template>
<script>
import MtdPicker from '@components/picker';
import MtdOption from '@components/option';
import { waitImmediate } from '@test/util';

export default {
  components: {
    MtdPicker,
    MtdOption,
  },
  data () {
    return {
      multiple: false,
      value: {
        id: '1',
        name: '李白',
      },
      options: [{
        id: '1',
        name: '李白',
      }, {
        id: '2',
        name: '李贺',
      }, {
        id: '3',
        name: '杜甫',
      }, {
        id: '4',
        name: '白居易',
      }, {
        id: '5',
        name: '屈原',
      }],
    };
  },
  methods: {
    formatter (option) {
      return `name: ${option.value.name}`;
    },
    async doTest (done) {
      const opt = this.options[0];

      this.value = {
        id: opt.id,
        name: 'xxx',
      };
      await waitImmediate();
      const textEl = this.$el.querySelector('.mtd-picker-values');
      const selected = {
        value: opt,
        label: opt.name,
      };
      expect(textEl.innerText).to.be.eql(this.formatter(selected));

      const opt2 = this.options[1];
      this.value = [{
        id: opt.id,
      }, {
        id: opt2.id,
      }];
      this.multiple = true;
      await waitImmediate();
      const selected2 = [{
        value: opt,
        label: opt.name,
      }, {
        value: opt2,
        label: opt2.name,
      }];
      expect(textEl.innerText).to.be.eql(
        selected2.map(this.formatter).join('、'),
      );

      done();
    },
  },
};
</script>
