<template>
<popper v-bind="$attrs" :tag="tag" :popper-disabled="disabled"
  :class="`${prefix}-rel`" :trigger="trigger"
  :visible="!disabled && visible" @update:visible="handleVisibleChange"
  :show-arrow="showArrow" ref="popper" :open-delay="openDelay"
  @clickoutside="clickoutside"
>
  <reference><slot /></reference>
  <drop
    :class="[prefix, {
      [`${prefix}-${_size}`]: _size ,
      [`${prefix}-${theme}`]: theme
    }, popperClass]"
    v-bind="popperAttrs"
  >
    <slot name="content">{{ content }}</slot>
  </drop>
</popper>
</template>
<script>
import {
  Popper,
  Drop,
  Reference,
} from '@components/popper';
import {
  CONFIG_PROVIDER,
  getPrefixCls,
  getSize,
} from '@/utils/config';

export default {
  name: 'Tooltip',
  components: {
    Popper,
    Drop,
    Reference,
  },
  inheritAttrs: false,
  model: {
    prop: 'visible',
  },
  props: {
    content: [String, Number],
    visible: Boolean,
    size: String,
    showArrow: {
      type: Boolean,
      default: true,
    },
    trigger: {
      type: String,
      default: 'hover',
    },
    popperClass: [String, Object, Array],
    popperAttrs: Object,
    disabled: Boolean,
    theme: {
      type: String,
    },
    openDelay: {
      type: Number,
      default: 300,
    },
    tag: {
      type: [String, Object],
      default: 'span',
    },
  },
  inject: {
    config: {
      from: CONFIG_PROVIDER,
      default: {
        getPrefixCls,
        getSize,
      },
    },
  },
  computed: {
    prefix () {
      return this.config.getPrefixCls('tooltip');
    },
    _size () {
      return this.config.getSize(this);
    },
  },
  methods: {
    clickoutside (e) {
      this.$emit('clickoutside', e);
    },
    handleVisibleChange (v) {
      this.$emit('input', v);
    },
    updatePopper () {
      const { popper } = this.$refs;
      if (this.visible && popper) {
        popper.updatePopper();
      }
    },
  },
};
</script>
