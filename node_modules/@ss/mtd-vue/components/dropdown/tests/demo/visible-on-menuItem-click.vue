<template>
  <mtd-dropdown :visible-on-menu-item-click="visibleOnMenuItemClick"
    v-model="visible">
    <mtd-button type="text">
      <span style="margin-right: 4px;">click</span>
      <i class="mtdicon mtdicon-down" />
    </mtd-button>
    <mtd-dropdown-menu slot="dropdown">
      <mtd-dropdown-menu-item ref="item" @click="handleClick">计算</mtd-dropdown-menu-item>
      <mtd-dropdown-menu-item>网络</mtd-dropdown-menu-item>
      <mtd-dropdown-menu-item>存储</mtd-dropdown-menu-item>
      <mtd-dropdown-menu-item>数据库</mtd-dropdown-menu-item>
    </mtd-dropdown-menu>
  </mtd-dropdown>
</template>
<script>
// trigger 为 click 时，点击 menu-item 不关闭下拉面板
export default {
  data () {
    return {
      visible: true,
      clickItem: false,
      visibleOnMenuItemClick: false,
    };
  },
  methods: {
    handleClick () {
      this.clickItem = true;
    },
    doTest (done, { triggerClick }) {
      const item = this.$refs.item.$el;
      triggerClick(item);
      expect(this.clickItem).to.be.true();
      expect(this.visible).to.be.false();

      this.visibleOnMenuItemClick = true;
      this.visible = true;
      this.$nextTick(() => {
        triggerClick(item);
        expect(this.visible, 'visible should be true when visibleOnMenuItemClick is true').to.be.true();
        done();
      });
    },
  },
};
</script>
