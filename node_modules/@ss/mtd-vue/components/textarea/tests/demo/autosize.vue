<template>
  <div>
    <mtd-textarea
      autosize
      v-model="textarea"
      placeholder="请输入内容"
      ref="textarea1"
      :style="{
        lineHeight: `${lineHeight}px`,
        borderWidth: `${borderWidth}px`,
        padding: `${paddingSize}px`,
        boxSizing: 'border-box',
      }"
    />
    <mtd-textarea
      v-model="textarea"
      :autosize="{ minRows: 2, maxRows: 4}"
      placeholder="请输入内容"
      ref="textarea2"
      :style="{
        lineHeight: `${lineHeight}px`,
        borderWidth: `${borderWidth}px`,
        padding: `${paddingSize}px`,
        boxSizing: 'border-box',
      }"
    />
  </div>
</template>

<script>
import { waitImmediate } from '@test/util';
import Textarea from '../../textarea';

export default {
  name: 'TextAreaAutosize',
  components: {
    MtdTextarea: Textarea,
  },
  data () {
    return {
      paddingSize: 8,
      borderWidth: 1,
      lineHeight: 22,
      textarea: '1xxxxx\n2xxxxx\n3xxxxx\n4xxxxx\n5xxxxx\n6xxxxx\n7xxxxx',
    };
  },
  methods: {
    async doTest (done) {
      const { paddingSize, borderWidth, lineHeight } = this;
      const textarea1 = this.$refs.textarea1;
      const textarea2 = this.$refs.textarea2;

      await waitImmediate();

      // singleHeight 22px; paddingSize: 2*8px; borderSize: 2px;
      expect(parseInt(textarea1.textareaCalcStyle.height))
        .to.be.equal(7 * lineHeight + 2 * paddingSize + 2 * borderWidth);
      expect(parseInt(textarea2.textareaCalcStyle.height))
        .to.be.equal(4 * lineHeight + 2 * paddingSize + 2 * borderWidth);

      this.textarea = '';
      await waitImmediate();

      expect(parseInt(textarea1.textareaCalcStyle.height))
        .to.be.equal(1 * lineHeight + 2 * paddingSize + 2 * borderWidth);
      expect(parseInt(textarea2.textareaCalcStyle.height))
        .to.be.equal(2 * lineHeight + 2 * paddingSize + 2 * borderWidth);

      done();
    },
  },
};
</script>
