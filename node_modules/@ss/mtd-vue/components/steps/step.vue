<template>
  <div
    :class="[prefix, {
      [`${prefix}-flex`]: !space,
      [`${prefix}-dot`]: dot,
    }]"
    :style="style">
    <div
      :class="[`${prefix}-head`, {
        [`${prefix}-${status}`]: true
      }]">
      <div
        :class="[`${prefix}-head-line`, {
          [`${prefix}-head-line-dot`]: dot && direction === 'vertical'
        }]" />
      <div v-if="icon || $slots.icon" :class="`${prefix}-head-icon`">
        <slot name="icon"><i :class="icon" /></slot>
      </div>
      <div v-else-if="dot"
        :class="`${prefix}-head-number`"
        :style="{border: 'none', background: 'none'}">
        <div :class="`${prefix}-head-dot`" />
      </div>
      <div v-else :class="`${prefix}-head-number`">
        <span v-if="status === 'process' || status === 'wait'">
          {{ index+1 }}
        </span>
        <i v-else :class="currentIcon" />
      </div>
    </div>
    <div
      :class="[`${prefix}-main`, {
        [`${prefix}-${status}`]: true
      }]">
      <div :class="`${prefix}-main-title`">
        <slot name="title">{{ title }}</slot>
      </div>
      <div :class="`${prefix}-main-description`">
        <slot name="description">{{ description }}</slot>
      </div>
    </div>
  </div>
</template>

<script>
import {
  CONFIG_PROVIDER,
  getPrefixCls,
  getIconCls,
} from '@/utils/config';

export default {
  name: 'Step',
  props: {
    index: Number,
    title: String,
    icon: String,
    description: String,
    status: String,
    direction: String,
    dot: Boolean,
    space: [Number, String],
  },
  inject: {
    config: {
      from: CONFIG_PROVIDER,
      default: {
        getPrefixCls,
        getIconCls,
      },
    },
  },
  computed: {
    prefix () {
      return this.config.getPrefixCls('step');
    },
    iconPrefix () {
      return this.config.getIconCls;
    },
    style () {
      const size = this.space;
      const space = (typeof size === 'number') ? size + 'px' : size;
      if (this.direction === 'vertical') {
        return { height: space };
      }
      return { width: space };
    },
    currentIcon () {
      if (this.icon) {
        return this.icon;
      }
      const { iconPrefix } = this;
      switch (this.status) {
      case 'error':
        return iconPrefix('close-thick');
      case 'cancel':
        return iconPrefix('warning');
      case 'finish':
        return iconPrefix('check-thick');
      default:
        break;
      }
      return undefined;
    },
  },
};
</script>
