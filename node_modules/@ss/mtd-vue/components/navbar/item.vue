<template>
  <popover v-bind="popperProps"
    class="mtd-navbar-item"
    :class="{
      'mtd-navbar-item-right': align === 'right',
      'mtd-navbar-item-active': active || ($slots.dropdown && visible)
    }"
    :disabled="!$slots.dropdown"
    ref="group" :trigger="trigger" :show-arrow="showArrow"
    :popper-class="dropdownCls"
    :visible="visible"
    :placement="placement"
    @input="updateVisible"
  >
    <nav-link class="mtd-navbar-item-link" :class="linkClass"
      v-bind="$attrs" ref="item"
      :route="route"
      @click="handleLinkClick">
      <slot />
    </nav-link>
    <div slot="content">
      <slot name="dropdown" />
    </div>
  </popover>
</template>
<script>
import NavLink from '@components/navbar-link';
import Popover from '@components/popover';
// todo 增加点击空白区域关闭下拉
export default {
  name: 'MtdNavbarItem',
  components: {
    NavLink,
    Popover,
  },
  inheritAttrs: false,
  props: {
    trigger: {
      type: String,
      default: 'click',
    },
    align: {
      type: String,
      default: 'left',
      validator: (v) => {
        return ['left', 'right'].indexOf(v) > -1;
      },
    },
    linkClass: String,
    visible: {
      type: Boolean,
      default: false,
    },
    active: {
      type: Boolean,
      default: false,
    },
    showArrow: {
      type: Boolean,
      default: false,
    },
    popperProps: Object,
    dropdownClass: {
      type: String,
      default: '',
    },
    route: [String, Object],
    placement: String,
  },
  computed: {
    dropdownCls () {
      return `mtd-navbar-item-dropdown ${this.dropdownClass}`;
    },
  },
  methods: {
    updateVisible (v) {
      this.$emit('update:visible', v);
    },
    handleLinkClick (e) {
      this.$emit('click', e);
    },
  },
};
</script>
