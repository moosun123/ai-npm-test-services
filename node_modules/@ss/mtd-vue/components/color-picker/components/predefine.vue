<template>
  <div :class="`${prefix}-predefine`">
    <div :class="`${prefix}-predefine-colors`">
      <div :class="[`${prefix}-predefine-color-selector`, {selected: item.selected, 'is-alpha': item._alpha < 100}]"
           v-for="(item, index) in rgbaColors"
           :key="colors[index]"
           @click="handleSelect(index)">
        <div :style="{'background-color': item.value}" />
      </div>
    </div>
  </div>
</template>

<script>
import Color from '../utils/color';
import { CONFIG_PROVIDER,
  getPrefixCls,
} from '@/utils/config';

export default {
  name: 'MtdColorPredefine',
  props: {
    colors: {
      type: Array,
      required: true,
    },
    color: {
      required: true,
      type: Object,
    },
  },
  inject: {
    config: {
      from: CONFIG_PROVIDER,
      default: {
        getPrefixCls,
      },
    },
  },
  data () {
    return {
      rgbaColors: this.parseColors(this.colors, this.color),
    };
  },
  computed: {
    prefix () {
      return this.config.getPrefixCls('color');
    },
  },
  watch: {
    '$parent.currentColor' (val) {
      const color = new Color();
      color.fromString(val);

      this.rgbaColors.forEach(item => {
        item.selected = color.compare(item);
      });
    },
    colors (newVal) {
      this.rgbaColors = this.parseColors(newVal, this.color);
    },
    color (newVal) {
      this.rgbaColors = this.parseColors(this.colors, newVal);
    },
  },
  methods: {
    handleSelect (index) {
      this.color.fromString(this.colors[index]);
    },
    parseColors (colors, color) {
      return colors.map(value => {
        const c = new Color();
        c.enableAlpha = true;
        c.format = 'rgba';
        c.fromString(value);
        c.selected = c.value === color.value;
        return c;
      });
    },
  },
};
</script>
