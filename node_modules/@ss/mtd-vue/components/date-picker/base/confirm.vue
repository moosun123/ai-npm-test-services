<template>
  <div :class="[prefix + '-confirm']">
    <slot>
      <mtd-button v-if="showBtnNow" size="small" type="text-primary"
        @click="handleClickNow">
        {{ labels.now }}
      </mtd-button>
      <mtd-button size="small" type="primary"
        @click="handleSuccess"
      >
        {{ labels.ok }}
      </mtd-button>
    </slot>
  </div>
</template>
<script>
import MtdButton from '@components/button';
import Locale from '@/mixins/locale';
import {
  CONFIG_PROVIDER,
  getPrefixCls,
} from '@/utils/config';

export default {
  components: { MtdButton },
  mixins: [Locale],
  props: {
    isTime: {
      type: Boolean,
      default: false,
    },
    timeDisabled: {
      type: Boolean,
      default: false,
    },
    showBtnNow: {
      type: Boolean,
      default: true,
    },
  },
  inject: {
    'CalendarPicker': {
      default: '',
    },
    config: {
      from: CONFIG_PROVIDER,
      default: {
        getPrefixCls,
      },
    },
  },
  computed: {
    prefix () {
      return this.config.getPrefixCls('picker');
    },
    timeClasses () {
      return `${this.prefix}-confirm-time`;
    },
    labels () {
      const labels = ['time', 'now', 'ok'];
      const values = [this.isTime ? 'selectDate' : 'selectTime', 'now', 'ok'];
      return labels.reduce((obj, key, i) => {
        obj[key] = this.t('el.datepicker.' + values[i]);
        return obj;
      }, {});
    },
  },
  methods: {
    handleClickNow () {
      this.$emit('click-now');
    },
    handleSuccess () {
      this.$emit('confirm');
    },
    handleToggleTime () {
      if (this.timeDisabled) return;
      this.$emit('toggle');
      if (this.CalendarPicker) {
        this.CalendarPicker.$emit('focus-input');
      }
    },
  },
};
</script>
