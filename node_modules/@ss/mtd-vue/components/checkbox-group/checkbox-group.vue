<template>
  <div :class="prefix">
    <slot />
  </div>
</template>
<script>
import {
  CONFIG_PROVIDER,
  getPrefixCls,
} from '@/utils/config';

export default {
  name: 'CheckboxGroup',
  props: {
    value: {
      type: Array,
      default () {
        return [];
      },
    },
    disabled: Boolean,
    name: String,
    min: Number,
    max: Number,
  },
  provide () {
    return {
      checkboxGroup: this,
    };
  },
  inject: {
    config: {
      from: CONFIG_PROVIDER,
      default: {
        getPrefixCls,
      },
    },
  },
  computed: {
    prefix () {
      return this.config.getPrefixCls('checkbox-group');
    },
  },
  created () {
    this.$on('checkboxChange', this.handleChange);
  },
  methods: {
    handleChange (checked, value) {
      const index = this.value.indexOf(value);
      const nextValue = [...this.value];
      if (checked) {
        nextValue.push(value);
      } else if (index !== -1) {
        nextValue.splice(index, 1);
      }
      const length = nextValue.length;
      if ((checked && this.max && length > this.max) ||
         (!checked && this.min && length < this.min)) {
        return;
      }
      this.$emit('input', nextValue);
      this.$emit('change', nextValue);
    },
  },
};
</script>
